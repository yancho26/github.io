<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nomeno X - The Master Algorithm</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;600;700;800&family=Playfair+Display:ital,wght@0,600;1,600&display=swap');

        :root {
            --glass-bg: rgba(10, 10, 20, 0.85);
            --glass-border: rgba(255, 255, 255, 0.08);
            --accent-gold: #fbbf24;
            --accent-purple: #a855f7;
        }

        body {
            font-family: 'Manrope', sans-serif;
            background-color: #050505;
            color: #f8fafc;
            overflow-x: hidden;
        }

        h1, h2, .serif-font {
            font-family: 'Playfair Display', serif;
        }

        /* Deep Space Background */
        .bg-mesh {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
            background: 
                radial-gradient(circle at 15% 50%, rgba(76, 29, 149, 0.15), transparent 25%),
                radial-gradient(circle at 85% 30%, rgba(219, 39, 119, 0.1), transparent 25%);
            background-color: #020204;
        }
        
        .stars {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
            background-image: 
                radial-gradient(white, rgba(255,255,255,.2) 2px, transparent 3px),
                radial-gradient(white, rgba(255,255,255,.15) 1px, transparent 2px),
                radial-gradient(white, rgba(255,255,255,.1) 2px, transparent 3px);
            background-size: 550px 550px, 350px 350px, 250px 250px;
            background-position: 0 0, 40px 60px, 130px 270px;
            opacity: 0.6;
        }

        /* Glass Card Ultimate */
        .glass-panel {
            background: var(--glass-bg);
            backdrop-filter: blur(40px);
            -webkit-backdrop-filter: blur(40px);
            border: 1px solid var(--glass-border);
            box-shadow: 0 20px 80px -10px rgba(0, 0, 0, 0.8);
        }

        /* Modern Inputs */
        .input-modern {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            color: white;
            transition: all 0.4s ease;
        }
        .input-modern:focus {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--accent-purple);
            box-shadow: 0 0 20px rgba(168, 85, 247, 0.15);
            outline: none;
        }
        .input-modern::placeholder { color: rgba(255, 255, 255, 0.2); }

        select.input-modern option {
            background-color: #0f172a;
            color: white;
        }

        /* Toggle Switch */
        .toggle-checkbox:checked {
            right: 0;
            border-color: var(--accent-purple);
        }
        .toggle-checkbox:checked + .toggle-label {
            background-color: var(--accent-purple);
        }

        /* Gender Buttons */
        .gender-btn {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .gender-btn:hover { background: rgba(255, 255, 255, 0.05); }
        .gender-btn.active {
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.2), rgba(59, 130, 246, 0.1));
            border-color: var(--accent-purple);
            box-shadow: 0 0 25px rgba(168, 85, 247, 0.25);
        }

        /* Animations */
        .fade-in-up { animation: fadeInUp 0.7s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }

        /* Drawer */
        #favoritesDrawer {
            transform: translateX(100%);
            transition: transform 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        }
        #favoritesDrawer.open { transform: translateX(0); }
        
        .shimmer {
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            background-size: 200% 100%;
            animation: shimmer 2s infinite;
        }
        @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center p-4 md:p-8">

    <div class="bg-mesh"></div>
    <div class="stars"></div>

    <!-- Nav -->
    <nav class="w-full max-w-5xl flex justify-between items-center mb-8 fade-in-up" style="animation-delay: 0.1s;">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-full border border-purple-500/30 flex items-center justify-center bg-purple-500/10 backdrop-blur-md">
                <i data-lucide="infinity" class="w-5 h-5 text-purple-400"></i>
            </div>
            <div>
                <h1 class="text-xl font-bold tracking-tight text-white leading-none font-serif">NOMENO <span class="text-purple-500">X</span></h1>
                <span class="text-[9px] uppercase tracking-[0.3em] text-gray-500 font-semibold">Master Algorithm</span>
            </div>
        </div>
        
        <button onclick="toggleFavorites()" class="group relative px-5 py-2 rounded-full bg-white/5 border border-white/10 hover:bg-white/10 transition flex items-center gap-2 overflow-hidden">
            <div class="absolute inset-0 bg-gradient-to-r from-purple-500/0 via-purple-500/10 to-purple-500/0 translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-700"></div>
            <i data-lucide="bookmark" class="w-4 h-4 text-purple-400 group-hover:scale-110 transition"></i>
            <span class="text-xs font-bold text-gray-300 hidden sm:inline">Списък</span>
            <span id="favCount" class="absolute -top-1 -right-1 flex h-4 w-4 items-center justify-center rounded-full bg-purple-600 text-[9px] font-bold text-white shadow-lg opacity-0 transition-opacity">0</span>
        </button>
    </nav>

    <!-- Main Card -->
    <div class="glass-panel w-full max-w-4xl rounded-3xl overflow-hidden fade-in-up relative z-10" style="animation-delay: 0.2s;">
        
        <!-- Input Section -->
        <div id="inputSection" class="p-6 md:p-10 space-y-10">
            
            <div class="text-center space-y-3 relative">
                <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-64 h-32 bg-purple-500/20 blur-[80px] rounded-full pointer-events-none"></div>
                <h2 class="relative text-3xl md:text-5xl font-bold text-white serif-font tracking-tight">
                    Открий идеалното име
                </h2>
                <p class="relative text-gray-400 text-sm md:text-base max-w-lg mx-auto leading-relaxed">
                    AI 10.0 анализира сричков ритъм, фонетична съвместимост и родова приемственост.
                </p>
            </div>

            <!-- Surname & Gender (Primary) -->
            <div class="grid grid-cols-1 md:grid-cols-12 gap-6 bg-white/[0.02] p-1 rounded-2xl border border-white/5">
                <div class="md:col-span-7 p-4">
                    <label class="text-[10px] font-bold text-gray-500 uppercase tracking-widest mb-2 block ml-1">Фамилия (Критично за ритъма)</label>
                    <div class="relative group">
                        <i data-lucide="align-left" class="absolute left-4 top-3.5 w-5 h-5 text-gray-500 group-focus-within:text-purple-400 transition-colors"></i>
                        <input type="text" id="surname" placeholder="напр. Маринов" class="input-modern w-full pl-12 pr-4 py-3 rounded-xl text-lg font-serif">
                    </div>
                </div>
                <div class="md:col-span-5 p-4 border-t md:border-t-0 md:border-l border-white/5">
                    <label class="text-[10px] font-bold text-gray-500 uppercase tracking-widest mb-2 block ml-1">Пол</label>
                    <div class="grid grid-cols-3 gap-2 h-[52px]">
                        <button onclick="setGender('boy')" id="btn-boy" class="gender-btn rounded-lg flex items-center justify-center"><i data-lucide="baby" class="w-5 h-5 text-blue-400"></i></button>
                        <button onclick="setGender('girl')" id="btn-girl" class="gender-btn rounded-lg flex items-center justify-center"><i data-lucide="baby" class="w-5 h-5 text-pink-400"></i></button>
                        <button onclick="setGender('random')" id="btn-random" class="gender-btn active rounded-lg flex items-center justify-center"><i data-lucide="sparkles" class="w-5 h-5 text-purple-400"></i></button>
                    </div>
                    <input type="hidden" id="selectedGender" value="random">
                </div>
            </div>

            <!-- Lineage & Origins -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Mother's Line -->
                <div class="space-y-4">
                    <div class="flex items-center gap-2 mb-1">
                        <div class="w-1 h-1 bg-pink-500 rounded-full"></div>
                        <span class="text-xs font-bold text-gray-400 uppercase tracking-wider">Майчина линия</span>
                    </div>
                    <input type="text" id="parent1" placeholder="Име на майката" class="input-modern w-full px-4 py-3 rounded-xl text-sm">
                    <select id="originMother" class="input-modern w-full px-4 py-3 rounded-xl text-sm cursor-pointer">
                        <option value="all">★ Всички Стилове (Смесено)</option>
                        <option value="modern">Модерни / Интернационални</option>
                        <option value="christian">Християнски / Класически</option>
                        <option value="slavic">Славянски / Български</option>
                        <option value="muslim">Мюсюлмански / Турски</option>
                        <option value="nature">Природа / Цветя</option>
                        <option value="royal">Царски / Исторически</option>
                        <option value="rare">Антични / Редки</option>
                    </select>
                    <div class="grid grid-cols-2 gap-2">
                        <input type="text" id="grandMaM" placeholder="Баба" class="input-modern px-3 py-2 rounded-lg text-xs bg-white/[0.01]">
                        <input type="text" id="grandPaM" placeholder="Дядо" class="input-modern px-3 py-2 rounded-lg text-xs bg-white/[0.01]">
                    </div>
                </div>

                <!-- Father's Line -->
                <div class="space-y-4">
                    <div class="flex items-center gap-2 mb-1">
                        <div class="w-1 h-1 bg-blue-500 rounded-full"></div>
                        <span class="text-xs font-bold text-gray-400 uppercase tracking-wider">Бащина линия</span>
                    </div>
                    <input type="text" id="parent2" placeholder="Име на бащата" class="input-modern w-full px-4 py-3 rounded-xl text-sm">
                    <select id="originFather" class="input-modern w-full px-4 py-3 rounded-xl text-sm cursor-pointer">
                        <option value="all">★ Всички Стилове (Смесено)</option>
                        <option value="modern">Модерни / Интернационални</option>
                        <option value="christian">Християнски / Класически</option>
                        <option value="slavic">Славянски / Български</option>
                        <option value="muslim">Мюсюлмански / Турски</option>
                        <option value="nature">Природа / Цветя</option>
                        <option value="royal">Царски / Исторически</option>
                        <option value="rare">Антични / Редки</option>
                    </select>
                    <div class="grid grid-cols-2 gap-2">
                        <input type="text" id="grandMaD" placeholder="Баба" class="input-modern px-3 py-2 rounded-lg text-xs bg-white/[0.01]">
                        <input type="text" id="grandPaD" placeholder="Дядо" class="input-modern px-3 py-2 rounded-lg text-xs bg-white/[0.01]">
                    </div>
                </div>
            </div>

            <!-- Advanced Toggles -->
            <div class="flex flex-wrap gap-4 justify-center md:justify-between items-center pt-4 border-t border-white/5">
                <div class="w-full md:w-auto flex-1 max-w-xs">
                    <input type="text" id="sibling" placeholder="Име на братче/сестриче" class="input-modern w-full px-4 py-2 rounded-lg text-sm text-center md:text-left bg-transparent border-white/10 focus:bg-white/5">
                </div>
                
                <div class="flex items-center gap-3 bg-white/5 px-4 py-2 rounded-full border border-white/5">
                    <span class="text-xs font-bold text-gray-300">Двойно име</span>
                    <div class="relative inline-block w-8 align-middle select-none transition duration-200 ease-in">
                        <input type="checkbox" name="toggle" id="doubleNameToggle" class="toggle-checkbox absolute block w-4 h-4 rounded-full bg-white border-2 border-gray-600 appearance-none cursor-pointer"/>
                        <label for="doubleNameToggle" class="toggle-label block overflow-hidden h-4 rounded-full bg-gray-700 cursor-pointer"></label>
                    </div>
                </div>
            </div>

            <button onclick="startGeneration()" class="group w-full py-5 rounded-2xl bg-white text-black font-bold text-lg tracking-widest shadow-[0_0_40px_-10px_rgba(255,255,255,0.3)] hover:shadow-[0_0_60px_-10px_rgba(168,85,247,0.5)] transform hover:scale-[1.005] transition-all duration-300 flex items-center justify-center gap-3 relative overflow-hidden">
                <div class="absolute inset-0 bg-gradient-to-r from-purple-200 via-white to-blue-200 opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                <span class="relative flex items-center gap-2">
                    <i data-lucide="sparkles" class="w-5 h-5 text-purple-600"></i> ГЕНЕРИРАЙ
                </span>
            </button>
        </div>

        <!-- Loader -->
        <div id="aiLoader" class="hidden p-12 text-center h-[600px] flex flex-col items-center justify-center relative">
            <div class="absolute inset-0 bg-[#050505]/80 backdrop-blur-xl z-0"></div>
            <div class="relative z-10 flex flex-col items-center">
                <div class="w-64 h-1 bg-gray-800 rounded-full overflow-hidden mb-6 relative">
                    <div class="absolute top-0 left-0 h-full bg-purple-500 shimmer w-full"></div>
                </div>
                <h3 class="text-3xl font-bold text-white mb-2 animate-pulse font-serif" id="aiStatus">Синхронизиране...</h3>
                <p class="text-gray-500 text-xs uppercase tracking-widest font-bold" id="aiSubStatus">Анализ на фонетичен поток</p>
            </div>
        </div>

        <!-- Result Section -->
        <div id="resultSection" class="hidden relative h-full">
            <div class="p-8 md:p-12 text-center">
                
                <!-- Navbar in result -->
                <div class="flex justify-between items-start w-full mb-10">
                    <button onclick="resetApp()" class="px-4 py-2 rounded-full bg-white/5 hover:bg-white/10 transition text-xs font-bold text-gray-400 hover:text-white flex items-center gap-2">
                        <i data-lucide="arrow-left" class="w-4 h-4"></i> Назад
                    </button>
                    <div class="flex flex-col items-end">
                        <span class="text-[10px] text-gray-500 uppercase tracking-widest font-bold">Съвместимост</span>
                        <div class="text-green-400 font-bold text-sm" id="matchScore">98%</div>
                    </div>
                </div>

                <!-- Name Display -->
                <div class="mb-14 relative group cursor-default">
                    <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full h-32 bg-purple-500/10 blur-[60px] rounded-full pointer-events-none opacity-50"></div>
                    <h2 id="generatedName" class="relative text-6xl md:text-7xl lg:text-8xl font-bold text-white mb-4 serif-font tracking-tight leading-none drop-shadow-2xl">
                        Име
                    </h2>
                    <p id="generatedSurname" class="text-xl md:text-3xl text-gray-500 font-light uppercase tracking-[0.4em]"></p>
                </div>

                <!-- Logic Breakdown -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-10 text-left">
                    
                    <!-- Meaning -->
                    <div class="bg-white/[0.03] p-6 rounded-2xl border border-white/5 hover:border-white/10 transition">
                        <div class="flex items-center gap-2 mb-3 text-purple-400 text-xs font-bold uppercase tracking-widest">
                            <i data-lucide="book-open" class="w-3 h-3"></i> Значение
                        </div>
                        <p id="nameMeaning" class="text-lg text-gray-200 font-serif italic">...</p>
                    </div>

                    <!-- AI Reasoning -->
                    <div class="bg-white/[0.03] p-6 rounded-2xl border border-white/5 hover:border-white/10 transition">
                        <div class="flex items-center gap-2 mb-3 text-blue-400 text-xs font-bold uppercase tracking-widest">
                            <i data-lucide="cpu" class="w-3 h-3"></i> Анализ на Nomeno X
                        </div>
                        <p id="nameReason" class="text-sm text-gray-400 leading-relaxed">...</p>
                    </div>
                </div>

                <!-- Stats Bar -->
                <div class="flex justify-between items-center border-t border-white/5 pt-6 pb-10 max-w-2xl mx-auto">
                    <div class="text-center">
                        <div class="text-[10px] text-gray-500 uppercase tracking-wider mb-1">Срички</div>
                        <div id="syllableStat" class="text-white font-bold font-mono">2-3</div>
                    </div>
                    <div class="w-px h-8 bg-white/10"></div>
                    <div class="text-center">
                        <div class="text-[10px] text-gray-500 uppercase tracking-wider mb-1">Число</div>
                        <div id="numerologyNum" class="text-purple-400 font-bold font-mono">7</div>
                    </div>
                    <div class="w-px h-8 bg-white/10"></div>
                    <div class="text-center">
                        <div class="text-[10px] text-gray-500 uppercase tracking-wider mb-1">Стил</div>
                        <div id="styleStat" class="text-blue-400 font-bold text-xs uppercase">Класика</div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="flex flex-col sm:flex-row justify-center gap-4 max-w-xl mx-auto">
                    <button onclick="feedback('dislike')" class="w-12 h-12 rounded-full border border-white/10 hover:bg-white/5 text-gray-500 hover:text-red-400 flex items-center justify-center transition">
                        <i data-lucide="x" class="w-5 h-5"></i>
                    </button>
                    
                    <button onclick="startGeneration(true)" class="flex-1 py-3 rounded-full bg-white/5 hover:bg-white/10 text-white font-bold text-xs uppercase tracking-widest border border-white/10 transition flex items-center justify-center gap-2 group">
                        <i data-lucide="shuffle" class="w-4 h-4 group-hover:rotate-180 transition duration-500 text-purple-400"></i> Следващо
                    </button>

                    <button onclick="feedback('like')" class="flex-1 py-3 rounded-full bg-white text-black font-bold text-xs uppercase tracking-widest shadow-lg hover:shadow-purple-500/20 transition flex items-center justify-center gap-2 group">
                        <i data-lucide="heart" class="w-4 h-4 group-hover:fill-red-500 group-hover:text-red-500 transition-colors"></i> Запази
                    </button>
                </div>
            </div>
        </div>

    </div>

    <!-- Favorites Drawer -->
    <div id="favoritesDrawer" class="fixed top-0 right-0 h-full w-full sm:w-[400px] bg-[#050505]/95 backdrop-blur-2xl border-l border-white/10 z-50 shadow-2xl flex flex-col">
        <div class="p-8 border-b border-white/10 flex justify-between items-center">
            <h3 class="font-serif text-2xl text-white italic">Любими</h3>
            <button onclick="toggleFavorites()" class="text-gray-500 hover:text-white transition"><i data-lucide="x" class="w-6 h-6"></i></button>
        </div>
        <div id="favoritesList" class="flex-1 overflow-y-auto p-6 space-y-4">
            <!-- Items injected here -->
        </div>
        <div class="p-6 border-t border-white/10 bg-black/40">
            <button onclick="exportFavorites()" class="w-full py-4 rounded-xl bg-white/5 hover:bg-white/10 text-white text-xs font-bold uppercase tracking-widest transition flex items-center justify-center gap-2">
                <i data-lucide="copy" class="w-4 h-4"></i> Копирай Всички
            </button>
        </div>
    </div>

    <script>
        // --- MASSIVE DATABASE (Version 10.0) ---
        // Using "Key:Value" string compression for performance
        const rawData = {
            christian_m: "Александър:Защитник на мъжете;Георги:Земеделец;Димитър:Посветен на земята;Никола:Победа на народа;Иван:Бог е милостив;Теодор:Божи дар;Борис:Борец;Стефан:Венец;Михаил:Кой е като Бог;Петър:Камък;Васил:Царствен;Христо:Помазаник;Атанас:Безсмъртен;Константин:Постоянен;Илия:Бог е Яхве;Симеон:Бог чува;Андрей:Мъжествен;Тодор:Божи дар;Гавраил:Божия сила;Йордан:Спускащ се;Данаил:Божи съд;Емануил:Бог е с нас;Матей:Божи дар;Лука:Светлина;Филип:Обичащ конете;Павел:Смирен;Стоян:Здрав;Антон:Ценен;Емил:Съперник;Кирил:Господар;Методий:Подреден;Лазар:Бог помага;Сава:Вино;Григор:Бдящ;Яков:Следващ;Спас:Спасител;Християн:Христов;Валери:Силен;Богомил:Мил на Бога;Тимотей:Почитащ Бога;Захари:Бог помни;Рафаил:Бог лекува;Самуил:Измолен от Бога;Давид:Любим;Йосиф:Бог прибавя;Марко:Войнствен;Тома:Близнак;Симон:Слушащ;Апостол:Пратеник;Евгени:Благороден;Иларион:Весел;Климент:Милостив;Леонид:Лъвски;Максим:Най-голям;Николай:Победа на народа;Продан:Даден;Ставри:Кръст;Теофил:Обичащ Бога;Юлиан:Къдрав;Янко:Бог е милостив;Алекси:Защитник;Анатоли:Източен;Вангел:Благовест;Дамян:Покорител;Костадин:Постоянен;Марин:Морски;Милан:Мил;Младен:Млад;Ненчо:Ненагледен;Пантелей:Всемилостив;Румен:Здрав;Ангел:Вестител;Божидар:Божи дар;Виктор:Победител;Владимир:Владетел на света;Деян:Деен;Евтим:Благодушен;Желязко:Здрав като желязо;Живко:Жив;Здравко:Здрав;Калоян:Хубав Иван;Красимир:Красив свят;Любомир:Любим на света;Момчил:Момък;Никодим:Победа на народа;Огнян:Огън;Пламен:Пламък;Радослав:Радост и слава;Светослав:Свята слава;Тихомир:Тих мир;Цветан:Цвете;Чавдар:Водач;Явор:Явор;Ясен:Ясен;Давид:Любим;Аарон:Просветлен;Авел:Дихание;Авраам:Баща на множества;Адам:Човек;Азария:Помощ от Бога;Ананий:Бог е милостив;Ванадий:Син на Бога;Вениамин:Син на десницата;Витяз:Войн;Влас:Власт;Гавриил:Божи човек;Гедеон:Косач;Григорий:Бдящ;Данаил:Бог е съдия;Езекиил:Бог ще укрепи;Елисей:Бог е спасение;Емануил:С нас е Бог;Ефрем:Плодовит;Захария:Бог си спомня;Илия:Яхве е Бог;Йоан:Бог е милостив;Йов:Преследван;Йона:Гълъб;Йосиф:Бог ще прибави;Исаак:Смях;Исая:Спасение от Господа;Калиник:Добър победител;Касиан:Празен;Киприан:От Кипър;Кирил:Господар;Климент:Милостив;Константин:Постоянен;Козма:Украсен;Лазар:Бог помага;Левкий:Бял;Леонид:Лъв;Лука:Светъл;Макарий:Блажен;Максим:Най-голям;Малахия:Божи пратеник;Матей:Божи дар;Мелетий:Грижлив;Методий:Подреден;Мина:Месечина;Михаил:Кой е като Бог;Мойсей:Избавен от водата;Наум:Утешител;Нестор:Завърнал се у дома;Никанор:Който вижда победата;Никита:Победител;Никифор:Победоносец;Никодим:Победа на народа;Нифонт:Трезвен;Павел:Малък;Паисий:Детски;Памфил:Обичан от всички;Панкратий:Всевластен;Пантелеймон:Всемилостив;Парамон:Твърд;Партений:Девствен;Паси:Страдащ;Патрикий:Бащин;Пахомий:Широкоплещест;Петър:Камък;Пимен:Пастир;Платон:Широк;Поликарп:Многоплоден;Порфирий:Пурпурен;Прокопий:Преуспяващ;Протасий:Първи;Рафаил:Изцеление Божие;Роман:Римлянин;Сава:Вино;Самуил:Бог чу;Северин:Строг;Серафим:Пламенен;Сергий:Висок;Сила:Сила;Силуан:Горски;Силвестър:Горски;Симеон:Слушане;Симон:Слушащ;Софроний:Целомъдрен;Спиридон:Кошница;Стефан:Венец;Стратон:Воюващ;Талале:Цъфтящ;Тарасий:Вълнуващ;Терентий:Търкащ;Тимотей:Почитащ Бога;Тит:Почтен;Тихон:Съдба;Трифон:Разкошен;Трофим:Хранител;Урбан:Градски;Фаддей:Хвала;Филарет:Любител на добродетелта;Филимон:Любящ;Филип:Любител на конете;Филотей:Любител на Бога;Флавиан:Русокос;Флегонт:Горящ;Флор:Цвете;Фока:Тюлен;Фома:Близнак;Фотий:Светъл;Фоти:Светлина;Фрол:Цвете;Харалампий:Сияещ от радост;Харитон:Благодатен;Христофор:Христоносец;Ювеналий:Младежки;Юлиан:Юлиев;Юлий:Юлиев;Юстин:Справедлив;Яков:Пета",
            christian_f: "Мария:Любима;София:Мъдрост;Елена:Светлина;Александра:Защитница;Виктория:Победа;Никол:Победа;Габриела:Божия сила;Йоана:Благодат;Теодора:Божи дар;Рая:Рай;Христина:Християнка;Ивана:Бог е милостив;Магдалена:От Магдала;Катерина:Чиста;Симона:Бог чува;Гергана:Земеделец;Стефани:Венец;Наталия:Рождество;Даниела:Бог е съдия;Елеонора:Бог е светлина;Анна:Благодат;Екатерина:Чиста;Михаела:Коя е като Бог;Василена:Царствена;Силвия:Горска;Кристина:Посветена;Диана:Божествена;Моника:Съветник;Вероника:Победа;Татяна:Уредителка;Юлия:Къдрава;Валерия:Силна;Елисавета:Бог е клетва;Марина:Морска;Надежда:Надежда;Вяра:Вяра;Любов:Любов;Ирина:Мир;Недялка:Неделя;Петя:Камък;Радка:Радост;Румяна:Румена;Светла:Светла;Стоянка:Устойчива;Тинка:Чиста;Цонка:Цвете;Яна:Бог е милостив;Антония:Ценна;Божидара:Дар;Ваня:Бог е милостив;Галина:Спокойствие;Дарина:Дарена;Емилия:Съперничка;Жана:Бог е милостив;Златка:Златна;Ива:Върба;Красимира:Красив мир;Лидия:От Лидия;Мая:Майка;Нина:Нежна;Олга:Свята;Павлина:Малка;Росица:Роса;Снежана:Снежна;Таня:Организатор;Фани:Венец;Християна:Християнка;Цвета:Цвете;Анастасия:Възкресение;Андреа:Мъжествена;Анелия:Ангел;Анита:Благодат;Бистра:Ясна;Боряна:Борец;Валентина:Здрава;Венета:Венец;Виолета:Теменужка;Дафина:Лавър;Десислава:Слава;Ева:Живот;Евелина:Живот;Жаклин:Следваща;Ивелина:Върба;Илина:Светлина;Калина:Калина;Камелия:Камелия;Лилия:Лилия;Людмила:Любима на хората;Милена:Мила;Мира:Мир;Невена:Невен;Пламена:Пламък;Полина:Малка;Радостина:Радост;Ралица:Орион;Ренета:Възраждаща се;Силвана:Горска;Станислава:Слава;Теменужка:Цвете;Цветелина:Цвете;Аделина:Благородна;Албена:Хубава;Божана:Божия;Весела:Весела;Виктория:Победа;Глория:Слава;Дария:Дарена;Елица:Ела;Зорница:Зорница;Ивет:Ива;Йорданка:Йордан;Катя:Чиста;Лора:Лавър;Миглена:Мила;Надя:Надежда;Преслава:Преславна;Радослава:Радост и слава;Севдалина:Любов;Славена:Слава;Теа:Богиня;Цветанка:Цвете",
            slavic_m: "Божидар:Дар от Бога;Владимир:Владеещ света;Калоян:Хубав Иван;Деян:Деен;Пламен:Огнен;Красимир:Красив свят;Мирослав:Мир и слава;Радослав:Радост;Боян:Войн;Огнян:Огън;Светослав:Свята слава;Драгомир:Драг на света;Момчил:Момък;Найден:Намерен;Бисер:Ценен;Веселин:Весел;Живко:Жив;Здравко:Здрав;Камен:Камък;Лъчезар:Лъч светлина;Радомир:Радост на света;Станимир:Стани мир;Тихомир:Тих мир;Цветан:Цвете;Ясен:Ясен;Явор:Явор;Борислав:Борба за слава;Венцислав:Венец на славата;Добромир:Добър свят;Любомир:Любим;Слави:Слава;Чавдар:Водач;Янко:Бог е милостив;Борил:Борец;Велислав:Велика слава;Десислав:Търсещ слава;Златомир:Златен свят;Искрен:Искрен;Милен:Мил;Преслав:Преславен;Ростислав:Растяща слава;Свилен:Копринен;Страхил:Страшен;Траян:Траен;Храбър:Смел;Цветомир:Цвете на мира;Ярослав:Силна слава;Бранко:Защитник;Велко:Голям;Горан:Планинец;Дако:Дар;Желязко:Здрав като желязо;Зарко:Злато;Йово:Млад;Койо:Спокоен;Лало:Лале;Манчо:Малък;Ненко:Ненагледен;Първан:Първи;Страцимир:Мирен страж;Тихон:Щастие;Угрин:Унгарец;Хранислав:Храни слава;Цако:Цако;Чанко:Чан;Шишман:Дебел;Щерйо:Звезда;Якуб:Яков;Янкул:Янко",
            slavic_f: "Ралица:Орион;Десислава:Намираща слава;Боряна:Борец;Калина:Хубава като калина;Цветелина:Цвете;Снежана:Снежна;Биляна:Билка;Радостина:Радост;Мира:Мир;Искра:Огнена искра;Жана:Живот;Зорница:Зора;Мила:Мила;Преслава:Преславна;Весела:Весела;Вяра:Вяра;Дарина:Дар;Елица:Ела;Живка:Жива;Златина:Златна;Ивелина:Върба;Красимира:Красива;Людмила:Любима на хората;Милена:Мила;Надежда:Надежда;Райна:Царица;Светлана:Светла;Славяна:Славянка;Станислава:Да стане славна;Цветана:Цвете;Яна:Река;Божидара:Дар от Бога;Велислава:Велика слава;Гергана:Земеделец;Добромира:Добър мир;Елка:Ела;Жени:Благородна;Зорка:Зора;Иглика:Цвете;Йорданка:Спускаща се;Катя:Чиста;Лиляна:Лилия;Мирослава:Мир и слава;Невена:Невен;Орлина:Орел;Пламена:Огнена;Радослава:Радост;Силвана:Горска;Теменужка:Цвете;Христина:Християнка;Цветанка:Цвете;Ягода:Плод;Блага:Блага;Венцислава:Венец на славата;Грозданка:Грозде;Диляна:Сърце;Евдокия:Благоволение;Жасмина:Жасмин;Здравка:Здрава;Илина:Светлина;Косара:Коса;Лазара:Бог помага;Малина:Сладка;Надка:Надежда;Перуника:Перуника;Рада:Радост;Севда:Любов;Тинтява:Тинтява;Фидана:Фиданка;Цонка:Цвете;Череша:Череша;Шипка:Шипка;Ясена:Ясен",
            modern_m: "Мартин:Войн;Виктор:Победител;Даниел:Божи съд;Кристиян:Християнин;Алекс:Защитник;Макс:Велик;Ерик:Вечен владетел;Филип:Любител на коне;Робърт:Ярка слава;Себастиан:Почитан;Оливър:Маслина;Лео:Лъв;Никълъс:Победа;Адриян:От Адрия;Денис:На Дионис;Крис:Христоносец;Тео:Бог;Лукас:Светъл;Матео:Божи дар;Ноа:Почивка;Адам:Човек;Бенджамин:Син на десницата;Габриел:Божия сила;Давид:Любим;Едуард:Пазител;Жул:Млад;Иън:Бог е милостив;Кевин:Красив;Леонардо:Смел лъв;Майкъл:Кой е като Бог;Нейтън:Даден;Патрик:Благородник;Райън:Малък крал;Сам:Бог чува;Томас:Близнак;Уилям:Решителен;Феликс:Щастлив;Хари:Владетел;Чарли:Свободен;Джейкъб:Заместник;Антъни:Ценен;Брайън:Висок;Джордж:Земеделец;Итън:Силен;Кало:Хубав;Луи:Славен войн;Марк:Войнствен;Нико:Победа;Оскар:Божие копие;Пол:Малък;Ричард:Смел;Стивън:Венец;Тони:Ценен;Франк:Свободен;Хенри:Владетел;Артур:Мечка;Арън:Висок;Бруно:Кафяв;Винсент:Завоевател;Грегор:Бдящ;Доминик:Господен;Ейдън:Огън;Елиас:Илия;Елиът:Бог е високо;Закари:Бог помни;Илай:Възвишен;Йонас:Гълъб;Калеб:Предан;Каспър:Съкровище;Колин:Победа;Лиъм:Войн;Логан:Малка дупка;Лука:Светлина;Майлс:Войник;Максимилиан:Най-голям;Марсел:Малък войн;Матиас:Божи дар;Мика:Кой е като Бог;Морис:Тъмен;Оуен:Благороден;Питър:Камък;Рафаел:Бог лекува;Робин:Ярка слава;Роман:Римлянин;Рубен:Виж сина;Саймън:Слушащ;Самюел:Бог чу;Сантяго:Свети Яков;Соломон:Мир;Спенсър:Домакин;Стенли:Каменна поляна;Теодор:Божи дар;Тимур:Желязо;Тобиас:Бог е добър;Тристан:Тъжен;Троя:Пехотинец;Фреди:Мирен;Фредерик:Мирен;Хуго:Ум;Чарлз:Свободен;Шон:Бог е милостив;Юри:Земеделец;Ян:Бог е милостив;Джак:Бог е милостив;Джеймс:Заместник",
            modern_f: "Ема:Цяла;Мия:Моя;Сара:Принцеса;Леа:Лъвица;Лили:Лилиум;Изабела:Обещание;Нора:Чест;Ева:Живот;Анна:Благодат;Джулия:Млада;Алис:Благородна;Карина:Скъпа;Мелиса:Пчела;Никол:Победа;Бела:Красива;Лора:Лавър;Дара:Дар;Ния:Цел;Амелия:Трудолюбива;Софи:Мъдрост;Оливия:Маслина;Емили:Съперничка;Ава:Живот;Шарлот:Свободна;Хана:Благодат;Зоя:Живот;Клара:Ясна;Луна:Луна;Мая:Илюзия;Натали:Рождество;Стела:Звезда;Вики:Победа;Елина:Светлина;Ивет:Тисово дърво;Кая:Чиста;Лара:Защитница;Мира:Мир;Неда:Родена в неделя;Поли:Малка;Рая:Рай;Симон:Бог чува;Теа:Богиня;Яна:Бог е милостив;Алина:Благородна;Бриджит:Силна;Ванеса:Пеперуда;Глория:Слава;Деа:Богиня;Елвира:Истина;Жизел:Залог;Ина:Силна;Кейт:Чиста;Лиза:Бог е клетва;Мона:Желание;Ника:Победа;Адел:Благородна;Адриана:Тъмна;Алекса:Защитница;Алми:Хранителна;Аманда:Достойна;Амбър:Кехлибар;Амели:Трудолюбива;Андреа:Смела;Аника:Благодат;Антоанета:Ценна;Ариана:Свята;Беатрис:Носеща щастие;Бети:Бог е клетва;Бланка:Бяла;Бренда:Меч;Валерия:Силна;Вероника:Образ;Вивиан:Жива;Габи:Божия сила;Грейс:Благодат;Дария:Богата;Дебора:Пчела;Джесика:Богатство;Джина:Кралица;Джоана:Бог е милостив;Джулиана:Млада;Дина:Съдена;Доротея:Божи дар;Евелин:Живот;Едит:Богатство;Елеонор:Светлина;Елиза:Бог е клетва;Елинор:Светлина;Емануела:Бог е с нас;Ерика:Вечна;Естер:Звезда;Жанет:Бог е милостив;Жозефина:Бог прибавя;Зара:Принцеса;Зинаида:Божествена;Иванина:Бог е милостив;Ивон:Тисово дърво;Изабел:Бог е клетва;Илона:Светлина;Ингрид:Красива;Инес:Чиста;Ирена:Мир;Ирма:Цяла;Йоана:Бог е милостив;Карла:Свободна;Каролина:Свободна;Касандра:Пророчица;Кели:Война;Киара:Ясна;Клара:Ясна;Клео:Слава;Кора:Девица;Кристиана:Християнка;Лаура:Лавър;Лена:Светлина;Леона:Лъвица;Летисия:Радост;Лиана:Ляна;Линда:Красива;Лола:Скръб;Лорета:Лавър;Луиза:Славен;Луси:Светлина;Маделин:От Магдала;Майя:Майка;Мануела:Бог е с нас;Марго:Перла;Мариса:На морето;Меган:Перла;Мелани:Тъмна;Мелинда:Медена;Мишел:Коя е като Бог;Моли:Море;Надя:Надежда;Наоми:Приятна",
            royal_m: "Симеон:Бог чува;Асен:Здрав;Самуил:Божие име;Ивайло:Вълк;Тервел:Бягащ;Борис:Борец;Калоян:Хубав Иван;Иван Александър:Защитник;Петър:Камък;Михаил:Кой е като Бог;Владимир:Владетел;Гаврил:Божия сила;Пресиян:Преславен;Крум:Скала;Омуртаг:Кръгъл;Кардам:Меч;Маламир:Малък мир;Бокил:Болярин;Расате:Владимир;Севар:Северен;Токту:Твърд;Умор:Умел;Аспарух:Бърз кон;Кубрат:Събирач;Алцек:Елен;Батбаян:Богат;Котраг:Смел;Телерик:Умен;Винех:Високо;Кормисош:Кормило",
            royal_f: "Теодора:Божи дар;Мария:Любима;Елеонора:Светлина;Ирина:Мир;Екатерина:Чиста;Елизабет:Бог е клетва;Виктория:Победа;Анастасия:Възкресение;Кера:Госпожа;Тамара:Палма;Десислава:Слава;Елена:Светлина;Анна:Благодат;Зоя:Живот;Мария-Луиза:Славна;Йоанна:Бог е милостив;Маргарита:Перла;Симона:Бог чува;Клементина:Милостива;Дживора:Жива;Евдокия:Благоволение;Кира:Господарка;Ксения:Чужденка;Надежда:Надежда;Олга:Свята"
        };

        const nameDatabase = {};
        for (const key in rawData) {
            nameDatabase[key] = rawData[key].split(';').map(entry => {
                const [name, meaning] = entry.split(':');
                return { name, meaning };
            });
        }

        // --- CORE LOGIC ---
        let favorites = JSON.parse(localStorage.getItem('nomeno_favorites')) || [];
        let generatedHistory = new Set();
        let lastGeneratedName = "";

        updateFavoritesUI();

        function setGender(g) {
            document.getElementById('selectedGender').value = g;
            document.querySelectorAll('.gender-btn').forEach(b => {
                b.classList.remove('active');
                if(b.id === `btn-${g}`) b.classList.add('active');
            });
        }

        function startGeneration(skipAnimation = false) {
            const delay = skipAnimation ? 300 : 2000;
            
            if(!skipAnimation) {
                document.getElementById('inputSection').classList.add('hidden');
                document.getElementById('resultSection').classList.add('hidden');
                document.getElementById('aiLoader').classList.remove('hidden');
                document.getElementById('aiLoader').classList.add('flex');

                let pct = 0;
                const interval = setInterval(() => {
                    pct += Math.floor(Math.random() * 15) + 5;
                    if(pct > 100) pct = 100;
                    document.getElementById('percentage').innerText = pct + '%';
                    
                    const statuses = ["Зареждане на невронната мрежа...", "Анализ на фонетичен поток...", "Проверка на родословието...", "Синхронизиране с фамилията...", "Финална селекция..."];
                    if(pct % 20 === 0 && pct < 100) {
                        document.getElementById('aiStatus').innerText = statuses[Math.floor(pct/20)];
                    }

                    if(pct === 100) clearInterval(interval);
                }, delay / 20);
            }

            setTimeout(() => {
                generateNameLogic(skipAnimation);
            }, delay);
        }

        function generateNameLogic(isShuffle) {
            // Inputs
            const p1 = document.getElementById('parent1').value.trim();
            const p2 = document.getElementById('parent2').value.trim();
            const grandMaM = document.getElementById('grandMaM').value.trim();
            const grandPaM = document.getElementById('grandPaM').value.trim();
            const grandMaD = document.getElementById('grandMaD').value.trim();
            const grandPaD = document.getElementById('grandPaD').value.trim();
            
            const surname = document.getElementById('surname').value.trim();
            const sibling = document.getElementById('sibling').value.trim();
            const originM = document.getElementById('originMother').value;
            const originF = document.getElementById('originFather').value;
            let gender = document.getElementById('selectedGender').value;
            const isDoubleName = document.getElementById('doubleNameToggle').checked;

            let finalGender = gender === 'random' ? (Math.random() > 0.5 ? 'boy' : 'girl') : gender;
            const genderKey = finalGender === 'boy' ? '_m' : '_f';

            // Pool Construction
            let pool = [];
            let keysToUse = [];

            if (originM === 'all' || originF === 'all') {
                const allKeys = Object.keys(nameDatabase).filter(k => k.endsWith(genderKey));
                keysToUse = allKeys;
            } else {
                keysToUse = [originM + genderKey, originF + genderKey, 'modern' + genderKey];
            }
            
            keysToUse.forEach(k => { if(nameDatabase[k]) pool = pool.concat(nameDatabase[k]); });

            // Variety Injection
            if(Math.random() > 0.8) pool = pool.concat(nameDatabase['modern' + genderKey]);

            if(pool.length < 20) pool = pool.concat(nameDatabase['modern' + genderKey]);
            
            // Filter History & Last
            pool = pool.filter((v,i,a) => a.findIndex(t => t.name === v.name) === i);
            pool = pool.filter(n => !generatedHistory.has(n.name));

            // Smart Shuffle: Avoid same starting letter
            if(isShuffle && lastGeneratedName && pool.length > 10) {
                const lastChar = lastGeneratedName.charAt(0);
                const filteredPool = pool.filter(n => n.name.charAt(0) !== lastChar);
                if(filteredPool.length > 0) pool = filteredPool;
            }

            if(pool.length === 0) {
                generatedHistory.clear();
                pool = pool.concat(nameDatabase['modern' + genderKey]);
            }

            // --- NOMENO X SCORING ---
            let bestCandidate = null;
            let maxScore = -1000;
            let logicText = "";

            pool.sort(() => Math.random() - 0.5);

            for (let candidate of pool) {
                let score = 0;
                let reasons = [];

                // 1. Initial Matching (Reduced Weight)
                if(p1 && candidate.name.startsWith(p1[0].toUpperCase())) { score += 5; reasons.push("инициал на майката"); }
                if(p2 && candidate.name.startsWith(p2[0].toUpperCase())) { score += 5; reasons.push("инициал на бащата"); }

                // 2. Grandparents Matching (Legacy Priority)
                const grandparents = [grandMaM, grandPaM, grandMaD, grandPaD].filter(Boolean);
                grandparents.forEach(gp => {
                    if (candidate.name.startsWith(gp[0].toUpperCase())) {
                        score += 25; // High bonus
                        const r = `наследство от ${gp}`;
                        if (!reasons.includes(r)) reasons.push(r);
                    }
                });

                // 3. Phonetic Flow with Surname
                if(surname) {
                    const lastCharName = candidate.name.slice(-1).toLowerCase();
                    const firstCharSur = surname.charAt(0).toLowerCase();
                    
                    // Count Syllables (Heuristic: count vowels)
                    const countSyllables = (str) => (str.match(/[аъоуеиюя]/gi) || []).length;
                    const nameSyl = countSyllables(candidate.name);
                    const surSyl = countSyllables(surname);

                    // A. Clash Avoidance
                    if(lastCharName === firstCharSur) { score -= 15; }

                    // B. Hard/Soft Sound Balance
                    const hardSounds = ['к', 'т', 'р', 'п', 'б', 'г', 'д'];
                    const softSounds = ['л', 'м', 'н', 'й', 'я', 'ю', 'и', 'е'];
                    const surHardness = surname.split('').filter(c => hardSounds.includes(c.toLowerCase())).length;
                    const nameSoftness = candidate.name.split('').filter(c => softSounds.includes(c.toLowerCase())).length;

                    if(surHardness > 3) {
                        if (nameSoftness >= 2) {
                            score += 10;
                            if (!reasons.includes("звукова мекота")) reasons.push("омекотява фамилията");
                        }
                    }

                    // C. Syllabic Rhythm (Golden Ratio: avoid X-X, prefer X-Y)
                    if (nameSyl !== surSyl) {
                        score += 8;
                        if (!reasons.includes("ритмика")) reasons.push("перфектен ритъм");
                    } else {
                        score -= 2; // Slight penalty for monotony
                    }
                }

                // 4. Sibling Harmony
                if(sibling) {
                    if(Math.abs(sibling.length - candidate.name.length) <= 1) { score += 10; }
                    if(sibling[0] === candidate.name[0]) { score += 5; }
                }

                // 5. Uniqueness Factor (Random Boost for discovery)
                if (Math.random() > 0.85) {
                    score += 12;
                    // Hidden gem logic
                }

                score += Math.random() * 30; // Random noise

                if(score > maxScore) {
                    maxScore = score;
                    bestCandidate = candidate;
                    logicText = reasons.length > 0 ? `Избрано заради: ${reasons.join(", ")}.` : "Отличен баланс на звучност и стил.";
                }
            }

            if(!bestCandidate) bestCandidate = pool[0];
            
            // --- DOUBLE NAME LOGIC ---
            let finalName = bestCandidate.name;
            let finalMeaning = bestCandidate.meaning;

            if (isDoubleName) {
                const shortNames = pool.filter(n => n.name.length <= 5 && n.name !== bestCandidate.name);
                const secondName = shortNames.length > 0 ? shortNames[Math.floor(Math.random() * shortNames.length)] : {name: "Мария", meaning: "Любима"}; 
                
                finalName = `${bestCandidate.name}-${secondName.name}`;
                finalMeaning = `${bestCandidate.meaning} + ${secondName.meaning}`;
                logicText += " Създадена е хармонична двойна комбинация.";
            }

            generatedHistory.add(finalName);
            lastGeneratedName = finalName;

            // --- DISPLAY ---
            document.getElementById('aiLoader').classList.add('hidden');
            document.getElementById('aiLoader').classList.remove('flex');
            document.getElementById('resultSection').classList.remove('hidden');
            document.getElementById('resultSection').classList.add('fade-in');

            document.getElementById('generatedName').innerText = finalName;
            document.getElementById('generatedSurname').innerText = surname;
            document.getElementById('nameMeaning').innerText = finalMeaning;
            document.getElementById('nameReason').innerText = logicText;
            document.getElementById('matchScore').innerText = Math.floor(92 + Math.random() * 7) + "%";

            // Determine Style
            const styleMap = {
                'modern': 'Модерен', 'christian': 'Класика', 'slavic': 'Традиция', 
                'muslim': 'Ориент', 'nature': 'Природа', 'royal': 'Царски', 'rare': 'Уникат'
            };
            // Simplistic style detection based on selected origin or fallback
            document.getElementById('styleStat').innerText = styleMap[originM] || 'Смесен';

            // Calculate Syllables for Display
            const countSyl = (str) => (str.match(/[аъоуеиюя]/gi) || []).length;
            document.getElementById('syllableStat').innerText = `${countSyl(finalName)}-${countSyl(surname || "")}`;

            calculateNumerology(finalName);
        }

        function calculateNumerology(name) {
            let sum = 0;
            const cleanName = name.toUpperCase().replace(/[^А-ЯA-Z]/g, '');
            for(let i=0; i<cleanName.length; i++) {
                sum += (cleanName.charCodeAt(i) % 9) + 1;
            }
            while(sum > 9) sum = String(sum).split('').reduce((a,b) => parseInt(a)+parseInt(b), 0);

            const meanings = {
                1: "Лидер", 2: "Дипломат", 3: "Творец", 4: "Практик",
                5: "Пътешественик", 6: "Защитник", 7: "Мистик",
                8: "Управител", 9: "Хуманист"
            };
            document.getElementById('numerologyNum').innerText = sum;
        }

        function feedback(type) {
            const currentName = document.getElementById('generatedName').innerText;
            if(type === 'dislike') {
                // Just regenerate without saving to block list (per user request)
                startGeneration(true);
            } else {
                const currentSurname = document.getElementById('generatedSurname').innerText;
                const currentMeaning = document.getElementById('nameMeaning').innerText;
                const exists = favorites.some(f => f.name === currentName);
                
                if(!exists) {
                    favorites.push({ name: currentName, surname: currentSurname, meaning: currentMeaning });
                    localStorage.setItem('nomeno_favorites', JSON.stringify(favorites));
                    updateFavoritesUI();
                    document.getElementById('favoritesDrawer').classList.add('open');
                }
            }
        }

        function toggleFavorites() {
            document.getElementById('favoritesDrawer').classList.toggle('open');
        }

        function updateFavoritesUI() {
            const list = document.getElementById('favoritesList');
            const count = document.getElementById('favCount');
            count.innerText = favorites.length;
            count.style.opacity = favorites.length > 0 ? 1 : 0;
            
            if(favorites.length === 0) {
                list.innerHTML = '<div class="text-center text-gray-500 mt-20 text-sm">Все още нямате запазени имена.<br>Кликнете "Запази", когато харесате име.</div>';
                return;
            }

            list.innerHTML = favorites.map(f => `
                <div class="bg-white/5 p-4 rounded-xl border border-white/5 flex justify-between items-center group hover:bg-white/10 transition">
                    <div>
                        <div class="font-bold text-white text-base">${f.name} ${f.surname}</div>
                        <div class="text-[10px] text-gray-400 italic mt-1">${f.meaning}</div>
                    </div>
                    <button onclick="removeFavorite('${f.name}')" class="text-gray-500 hover:text-red-400 p-2 rounded-lg hover:bg-white/5 transition">
                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                    </button>
                </div>
            `).join('');
            lucide.createIcons();
        }

        function removeFavorite(name) {
            favorites = favorites.filter(f => f.name !== name);
            localStorage.setItem('nomeno_favorites', JSON.stringify(favorites));
            updateFavoritesUI();
        }

        function clearFavorites() {
            if(confirm("Сигурни ли сте?")) {
                favorites = [];
                localStorage.setItem('nomeno_favorites', JSON.stringify(favorites));
                updateFavoritesUI();
            }
        }

        function exportFavorites() {
            if(favorites.length === 0) return;
            const text = favorites.map(f => `${f.name} ${f.surname} - ${f.meaning}`).join('\n');
            navigator.clipboard.writeText(text).then(() => {
                alert("Списъкът е копиран!");
            });
        }

        function resetApp() {
            document.getElementById('resultSection').classList.add('hidden');
            document.getElementById('inputSection').classList.remove('hidden');
        }

        lucide.createIcons();
    </script>
</body>
</html>
