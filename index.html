<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ò–º–µ—Ç–æ –Ω–∞ –ß—É–¥–æ—Ç–æ - –ï–∫—Å–ø–µ—Ä—Ç–µ–Ω –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons CDN -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        @keyframes progressAnim {
            0% { width: 0%; }
            30% { width: 40%; }
            70% { width: 85%; }
            100% { width: 100%; }
        }
        .animate-progress-bar {
            animation: progressAnim 3s ease-in-out forwards;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in {
            animation: fadeIn 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }
        
        .step-container { display: none; }
        .step-container.active { display: block; }
        
        /* –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–∞–Ω —Å–∫—Ä–æ–ª–±–∞—Ä */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; border: 2px solid transparent; background-clip: padding-box; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; border: 2px solid transparent; background-clip: padding-box; }
        
        /* –°–∫—Ä–∏–≤–∞–Ω–µ –Ω–∞ —Ä–∞–¥–∏–æ –±—É—Ç–æ–Ω–∏ */
        input[type="radio"].hidden-radio { display: none; }
    </style>
</head>
<body class="bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 font-sans text-gray-800 min-h-screen relative selection:bg-pink-200 selection:text-pink-900">

    <!-- –•–µ–¥—ä—Ä -->
    <header class="bg-white/90 backdrop-blur-lg shadow-sm sticky top-0 z-10 border-b border-white/20">
        <div class="max-w-5xl mx-auto px-4 py-4 flex items-center justify-between">
            <div class="flex items-center gap-2 text-indigo-600 hover:scale-105 transition-transform cursor-pointer" onclick="resetForm()">
                <i data-lucide="baby" class="w-8 h-8"></i>
                <h1 class="text-2xl font-black tracking-tight hidden sm:block bg-clip-text text-transparent bg-gradient-to-r from-indigo-600 to-pink-500">–ò–º–µ—Ç–æ –Ω–∞ –ß—É–¥–æ—Ç–æ</h1>
                <h1 class="text-xl font-bold tracking-tight sm:hidden text-indigo-600">–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä</h1>
            </div>
            <div class="flex items-center gap-3 sm:gap-4">
                <div class="hidden md:flex text-xs font-semibold text-gray-500 items-center gap-1.5 bg-gray-100/80 px-4 py-2 rounded-full border border-gray-200 shadow-inner">
                    <i data-lucide="database" class="w-4 h-4 text-indigo-400"></i>
                    <span id="db-count-badge">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...</span>
                </div>
                <button onclick="openFavorites()" class="relative flex items-center gap-1.5 bg-gradient-to-r from-pink-100 to-rose-100 hover:from-pink-200 hover:to-rose-200 text-pink-700 px-5 py-2 rounded-full transition-all font-bold shadow-sm hover:shadow">
                    <i data-lucide="heart" class="w-4 h-4" id="header-heart-icon"></i>
                    <span class="hidden sm:inline">–õ—é–±–∏–º–∏</span>
                    <span id="fav-count-badge" class="hidden absolute -top-1.5 -right-1.5 bg-pink-500 text-white text-[11px] font-black w-5 h-5 rounded-full flex items-center justify-center shadow-md border-2 border-white">0</span>
                </button>
            </div>
        </div>
    </header>

    <main class="max-w-4xl mx-auto px-4 py-8 sm:py-12">
        
        <!-- –ü—Ä–æ–≥—Ä–µ—Å –±–∞—Ä -->
        <div id="progress-section" class="mb-10 max-w-2xl mx-auto">
            <div class="flex justify-between text-xs font-bold text-gray-400 mb-3 px-2 uppercase tracking-wider">
                <span id="prog-text-1" class="text-indigo-600 transition-colors">1. –û—Å–Ω–æ–≤–∏</span>
                <span id="prog-text-2" class="transition-colors">2. –°—Ç–∏–ª</span>
                <span id="prog-text-3" class="transition-colors">3. –†–æ–¥</span>
            </div>
            <div class="h-2.5 bg-gray-200 rounded-full overflow-hidden shadow-inner">
                <div id="progress-bar" class="h-full bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 transition-all duration-500 ease-out" style="width: 33.33%;"></div>
            </div>
        </div>

        <div class="bg-white/80 backdrop-blur-sm rounded-[2rem] shadow-2xl overflow-hidden border border-white">
            <div class="p-6 sm:p-12 relative">
                
                <!-- –°—Ç—ä–ø–∫–∞ 1: –ü–æ–ª -->
                <div id="step-1" class="step-container active fade-in">
                    <div class="text-center mb-10">
                        <div class="w-20 h-20 bg-indigo-50 text-indigo-600 rounded-full flex items-center justify-center mx-auto mb-6 shadow-inner border border-indigo-100">
                            <i data-lucide="baby" class="w-10 h-10"></i>
                        </div>
                        <h2 class="text-4xl font-black text-gray-900 mb-3">–ö–æ–≥–æ –æ—á–∞–∫–≤–∞—Ç–µ?</h2>
                        <p class="text-lg text-gray-500">–ù–µ–∫–∞ –∑–∞–ø–æ—á–Ω–µ–º –ø—ä—Ç–µ—à–µ—Å—Ç–≤–∏–µ—Ç–æ —Å –Ω–∞–π-–≤–∞–∂–Ω–æ—Ç–æ.</p>
                    </div>

                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-5 mb-12 max-w-2xl mx-auto">
                        <label class="cursor-pointer group">
                            <input type="radio" name="gender" value="m" class="hidden-radio" onchange="selectGender('m')">
                            <div id="btn-gender-m" class="p-6 rounded-3xl border-2 transition-all border-gray-100 bg-white group-hover:border-blue-200 group-hover:bg-blue-50/50 text-center shadow-sm">
                                <div class="text-4xl mb-3 transform group-hover:scale-110 transition-transform">üë¶üèª</div>
                                <div class="text-lg font-bold text-gray-700">–ú–æ–º—á–µ</div>
                            </div>
                        </label>
                        <label class="cursor-pointer group">
                            <input type="radio" name="gender" value="f" class="hidden-radio" onchange="selectGender('f')">
                            <div id="btn-gender-f" class="p-6 rounded-3xl border-2 transition-all border-gray-100 bg-white group-hover:border-pink-200 group-hover:bg-pink-50/50 text-center shadow-sm">
                                <div class="text-4xl mb-3 transform group-hover:scale-110 transition-transform">üëßüèª</div>
                                <div class="text-lg font-bold text-gray-700">–ú–æ–º–∏—á–µ</div>
                            </div>
                        </label>
                        <label class="cursor-pointer group">
                            <input type="radio" name="gender" value="any" class="hidden-radio" onchange="selectGender('any')" checked>
                            <div id="btn-gender-any" class="p-6 rounded-3xl border-2 transition-all border-purple-500 bg-purple-50 text-center shadow-md">
                                <div class="text-4xl mb-3 transform group-hover:scale-110 transition-transform">üéÅ</div>
                                <div class="text-lg font-bold text-purple-700">–ò–∑–Ω–µ–Ω–∞–¥–∞</div>
                            </div>
                        </label>
                    </div>
                    
                    <div class="flex justify-center sm:justify-end">
                        <button onclick="goToStep(2)" class="w-full sm:w-auto flex items-center justify-center gap-2 bg-gray-900 hover:bg-black text-white px-8 py-4 rounded-full font-bold transition-all shadow-lg hover:shadow-xl hover:-translate-y-0.5">
                            –ù–∞–ø—Ä–µ–¥ –∫—ä–º –°—Ç–∏–ª <i data-lucide="arrow-right" class="w-5 h-5"></i>
                        </button>
                    </div>
                </div>

                <!-- –°—Ç—ä–ø–∫–∞ 2: –ö—É–ª—Ç—É—Ä–∞, –£—Å–µ—â–∞–Ω–µ –∏ –î—ä–ª–∂–∏–Ω–∞ -->
                <div id="step-2" class="step-container fade-in">
                    <div class="text-center mb-8">
                        <div class="w-20 h-20 bg-purple-50 text-purple-600 rounded-full flex items-center justify-center mx-auto mb-6 shadow-inner border border-purple-100">
                            <i data-lucide="sparkles" class="w-10 h-10"></i>
                        </div>
                        <h2 class="text-3xl sm:text-4xl font-black text-gray-900 mb-3">–°—Ç–∏–ª –∏ –ó–≤—É—á–µ–Ω–µ</h2>
                        <p class="text-gray-500">–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–∞–π—Ç–µ –∫–∞–∫ –∏—Å–∫–∞—Ç–µ –¥–∞ —Å–µ —É—Å–µ—â–∞ –∏–º–µ—Ç–æ.</p>
                    </div>

                    <div class="space-y-8 mb-10 max-w-3xl mx-auto text-left">
                        <!-- –ö—É–ª—Ç—É—Ä–∞ -->
                        <div>
                            <h3 class="text-sm font-bold text-gray-400 uppercase tracking-wider mb-3 ml-2">1. –ö—É–ª—Ç—É—Ä–∞ –∏ –ü—Ä–æ–∏–∑—Ö–æ–¥</h3>
                            <div class="grid grid-cols-2 sm:grid-cols-3 gap-3" id="culture-options">
                                <!-- –ì–µ–Ω–µ—Ä–∏—Ä–∞ —Å–µ –æ—Ç JS -->
                            </div>
                        </div>

                        <!-- –£—Å–µ—â–∞–Ω–µ / –ó–Ω–∞—á–µ–Ω–∏–µ -->
                        <div>
                            <h3 class="text-sm font-bold text-gray-400 uppercase tracking-wider mb-3 ml-2 flex items-center gap-2">
                                2. –ñ–µ–ª–∞–Ω–æ –ü–æ—Å–ª–∞–Ω–∏–µ <span class="bg-pink-100 text-pink-600 text-[10px] px-2 py-0.5 rounded-full">–ù–æ–≤–æ</span>
                            </h3>
                            <div class="grid grid-cols-2 sm:grid-cols-3 gap-3" id="vibe-options">
                                <!-- –ì–µ–Ω–µ—Ä–∏—Ä–∞ —Å–µ –æ—Ç JS -->
                            </div>
                        </div>

                        <!-- –î—ä–ª–∂–∏–Ω–∞ -->
                        <div>
                            <h3 class="text-sm font-bold text-gray-400 uppercase tracking-wider mb-3 ml-2">3. –î—ä–ª–∂–∏–Ω–∞ –Ω–∞ –∏–º–µ—Ç–æ</h3>
                            <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
                                <label class="flex items-center p-4 rounded-2xl border-2 cursor-pointer transition-all border-indigo-500 bg-indigo-50 shadow-sm" id="len-lbl-any" onclick="selectLength('any')">
                                    <input type="radio" name="length" value="any" checked class="w-5 h-5 text-indigo-600 focus:ring-indigo-500 border-gray-300">
                                    <span class="ml-3 font-bold text-indigo-900">–ë–µ–∑ –∑–Ω–∞—á–µ–Ω–∏–µ</span>
                                </label>
                                <label class="flex items-center p-4 rounded-2xl border-2 cursor-pointer transition-all border-gray-100 hover:bg-gray-50" id="len-lbl-short" onclick="selectLength('short')">
                                    <input type="radio" name="length" value="short" class="w-5 h-5 text-indigo-600 focus:ring-indigo-500 border-gray-300">
                                    <span class="ml-3 font-semibold text-gray-700">–ö—Ä–∞—Ç–∫–æ (–¥–æ 5 –±.)</span>
                                </label>
                                <label class="flex items-center p-4 rounded-2xl border-2 cursor-pointer transition-all border-gray-100 hover:bg-gray-50" id="len-lbl-long" onclick="selectLength('long')">
                                    <input type="radio" name="length" value="long" class="w-5 h-5 text-indigo-600 focus:ring-indigo-500 border-gray-300">
                                    <span class="ml-3 font-semibold text-gray-700">–î—ä–ª–≥–æ (–Ω–∞–¥ 5 –±.)</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex flex-col-reverse sm:flex-row justify-between items-center gap-4 max-w-3xl mx-auto">
                        <button onclick="goToStep(1)" class="w-full sm:w-auto text-gray-500 hover:text-gray-900 px-6 py-4 font-bold transition-colors">–ù–∞–∑–∞–¥</button>
                        <button onclick="goToStep(3)" class="w-full sm:w-auto flex items-center justify-center gap-2 bg-gray-900 hover:bg-black text-white px-8 py-4 rounded-full font-bold transition-all shadow-lg hover:shadow-xl hover:-translate-y-0.5">
                            –ù–∞–ø—Ä–µ–¥ –∫—ä–º –†–æ–¥ <i data-lucide="arrow-right" class="w-5 h-5"></i>
                        </button>
                    </div>
                </div>

                <!-- –°—Ç—ä–ø–∫–∞ 3: –†–æ–¥ –∏ –§–∞–º–∏–ª–∏—è -->
                <div id="step-3" class="step-container fade-in">
                    <div class="text-center mb-8">
                        <div class="w-20 h-20 bg-pink-50 text-pink-600 rounded-full flex items-center justify-center mx-auto mb-6 shadow-inner border border-pink-100">
                            <i data-lucide="network" class="w-10 h-10"></i>
                        </div>
                        <h2 class="text-3xl sm:text-4xl font-black text-gray-900 mb-3">–°–µ–º–µ–π–Ω–∏ –¢—Ä–∞–¥–∏—Ü–∏–∏</h2>
                        <p class="text-gray-500 max-w-lg mx-auto">–ù–∞—à–∏—è—Ç –∞–ª–≥–æ—Ä–∏—Ç—ä–º —â–µ –∞–Ω–∞–ª–∏–∑–∏—Ä–∞ —Å—Ä–∏—á–∫–∏—Ç–µ –∏ —Ñ–æ–Ω–µ—Ç–∏—á–Ω–∏—è —Ä–∏—Ç—ä–º, –∑–∞ –¥–∞ –Ω–∞–º–µ—Ä–∏ –ø–µ—Ä—Ñ–µ–∫—Ç–Ω–æ—Ç–æ —Å—ä—á–µ—Ç–∞–Ω–∏–µ.</p>
                    </div>

                    <div class="space-y-6 mb-10 text-left max-w-3xl mx-auto">
                        
                        <!-- –û—Å–Ω–æ–≤–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                        <div class="bg-gradient-to-br from-indigo-50 to-blue-50/30 p-6 sm:p-8 rounded-[2rem] border border-indigo-100/50 shadow-sm relative overflow-hidden">
                            <div class="absolute -right-6 -top-6 text-indigo-100 opacity-50"><i data-lucide="file-signature" class="w-32 h-32"></i></div>
                            <h3 class="text-xl font-bold text-indigo-900 mb-5 flex items-center gap-2 relative z-10">
                                –ó–∞ –ø—ä–ª–Ω–æ—Ç–æ –∏–º–µ
                            </h3>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-5 relative z-10">
                                <div class="sm:col-span-2">
                                    <label class="block text-sm font-bold text-gray-700 mb-1.5">–§–∞–º–∏–ª–∏—è –Ω–∞ –¥–µ—Ç–µ—Ç–æ</label>
                                    <input type="text" id="inp-lastName" class="w-full px-5 py-3.5 bg-white border-2 border-transparent focus:border-indigo-300 rounded-2xl focus:ring-0 outline-none transition-all shadow-sm" placeholder="–Ω–∞–ø—Ä. –ì–µ–æ—Ä–≥–∏–µ–≤ / –ì–µ–æ—Ä–≥–∏–µ–≤–∞"/>
                                </div>
                                <div>
                                    <label class="block text-sm font-bold text-gray-700 mb-1.5">–ò–º–µ –Ω–∞ –±–∞—â–∞—Ç–∞ <span class="text-xs font-normal text-gray-400">(–∑–∞ –ü—Ä–µ–∑–∏–º–µ)</span></label>
                                    <input type="text" id="inp-fatherName" class="w-full px-5 py-3.5 bg-white border-2 border-transparent focus:border-indigo-300 rounded-2xl focus:ring-0 outline-none transition-all shadow-sm" placeholder="–Ω–∞–ø—Ä. –ò–≤–∞–Ω"/>
                                </div>
                                <div>
                                    <label class="block text-sm font-bold text-gray-700 mb-1.5">–ò–º–µ –Ω–∞ –º–∞–π–∫–∞—Ç–∞ <span class="text-xs font-normal text-gray-400">(–ø–æ –∂–µ–ª–∞–Ω–∏–µ)</span></label>
                                    <input type="text" id="inp-motherName" class="w-full px-5 py-3.5 bg-white border-2 border-transparent focus:border-indigo-300 rounded-2xl focus:ring-0 outline-none transition-all shadow-sm" placeholder="–Ω–∞–ø—Ä. –ú–∞—Ä–∏—è"/>
                                </div>
                                <div class="sm:col-span-2 mt-2">
                                    <label class="block text-sm font-black text-indigo-600 mb-1.5 flex items-center gap-1">
                                        <i data-lucide="zap" class="w-4 h-4"></i> –ñ–µ–ª–∞–Ω–∞ –ø—ä—Ä–≤–∞ –±—É–∫–≤–∞ (–û–≥—Ä–æ–º–µ–Ω –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
                                    </label>
                                    <input type="text" id="inp-preferredLetter" maxlength="1" class="w-full px-5 py-3.5 bg-white border-2 border-indigo-200 focus:border-indigo-500 rounded-2xl focus:ring-0 outline-none transition-all uppercase shadow-inner text-lg font-bold placeholder:font-normal placeholder:text-base placeholder:normal-case" placeholder="–ê–∫–æ –∏–º–∞—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—á–Ω–æ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–Ω–∏–µ, –≤—ä–≤–µ–¥–µ—Ç–µ –±—É–∫–≤–∞..."/>
                                </div>
                            </div>
                        </div>

                        <!-- –ë–∞–±–∏ –∏ –¥—è–¥–æ–≤—Ü–∏ -->
                        <div class="bg-gradient-to-br from-pink-50 to-rose-50/30 p-6 sm:p-8 rounded-[2rem] border border-pink-100/50 shadow-sm relative overflow-hidden">
                            <div class="absolute -right-6 -bottom-6 text-pink-100 opacity-50"><i data-lucide="users" class="w-32 h-32"></i></div>
                            <h3 class="text-xl font-bold text-pink-900 mb-5 flex items-center gap-2 relative z-10">
                                –ò–º–µ–Ω–∞ –Ω–∞ –±–∞–±–∏ –∏ –¥—è–¥–æ–≤—Ü–∏
                            </h3>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 relative z-10">
                                <input type="text" id="inp-gp1" class="w-full px-5 py-3 bg-white border-2 border-transparent focus:border-pink-300 rounded-2xl outline-none shadow-sm transition-all" placeholder="–ë–∞–±–∞ / –î—è–¥–æ 1"/>
                                <input type="text" id="inp-gp2" class="w-full px-5 py-3 bg-white border-2 border-transparent focus:border-pink-300 rounded-2xl outline-none shadow-sm transition-all" placeholder="–ë–∞–±–∞ / –î—è–¥–æ 2"/>
                                <input type="text" id="inp-gp3" class="w-full px-5 py-3 bg-white border-2 border-transparent focus:border-pink-300 rounded-2xl outline-none shadow-sm transition-all" placeholder="–ë–∞–±–∞ / –î—è–¥–æ 3"/>
                                <input type="text" id="inp-gp4" class="w-full px-5 py-3 bg-white border-2 border-transparent focus:border-pink-300 rounded-2xl outline-none shadow-sm transition-all" placeholder="–ë–∞–±–∞ / –î—è–¥–æ 4"/>
                            </div>
                            <p class="text-xs text-pink-600/70 mt-4 relative z-10 font-medium">–ê–ª–≥–æ—Ä–∏—Ç—ä–º—ä—Ç —â–µ —Ç—ä—Ä—Å–∏ –ø—ä–ª–Ω–æ —Å—ä–≤–ø–∞–¥–µ–Ω–∏–µ, —Å—ä–≤–ø–∞–¥–µ–Ω–∏–µ –Ω–∞ –∫–æ—Ä–µ–Ω –∏–ª–∏ –Ω–∞ –ø—ä—Ä–≤–∞ –±—É–∫–≤–∞.</p>
                        </div>
                    </div>

                    <div class="flex flex-col-reverse sm:flex-row justify-between items-center gap-4 max-w-3xl mx-auto">
                        <button onclick="goToStep(2)" class="w-full sm:w-auto text-gray-500 hover:text-gray-900 px-6 py-4 font-bold transition-colors">–ù–∞–∑–∞–¥</button>
                        <button onclick="generateNamesBtnClick(false)" id="btn-generate" class="w-full sm:w-auto flex justify-center items-center gap-2 bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 hover:from-indigo-700 hover:via-purple-700 hover:to-pink-700 text-white px-10 py-4 rounded-full font-black text-lg shadow-xl shadow-indigo-200 transition-all transform hover:scale-105">
                            <span>–ì–ï–ù–ï–†–ò–†–ê–ô</span> <i data-lucide="sparkles" class="w-6 h-6"></i>
                        </button>
                    </div>
                </div>

                <!-- –ï–∫—Ä–∞–Ω –∑–∞ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ -->
                <div id="loading-screen" class="hidden absolute inset-0 bg-white/95 backdrop-blur-md z-20 flex flex-col items-center justify-center rounded-[2rem] p-6 text-center">
                    <div class="relative w-24 h-24 mb-6">
                        <div class="absolute inset-0 border-4 border-indigo-100 rounded-full"></div>
                        <div class="absolute inset-0 border-4 border-indigo-600 rounded-full border-t-transparent animate-spin"></div>
                        <i data-lucide="cpu" class="w-10 h-10 text-indigo-600 absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2"></i>
                    </div>
                    <h3 class="text-3xl font-black text-gray-900 mb-3 bg-clip-text text-transparent bg-gradient-to-r from-indigo-600 to-purple-600">–ï–∫—Å–ø–µ—Ä—Ç–µ–Ω –ê–Ω–∞–ª–∏–∑</h3>
                    <p class="text-lg text-gray-500 max-w-sm font-medium" id="loading-text">–°–∏–Ω—Ç–µ–∑–∏—Ä–∞–Ω–µ –Ω–∞ –ø–µ—Ä—Ñ–µ–∫—Ç–Ω–∏—Ç–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏...</p>
                    <div class="w-full max-w-sm h-3 bg-gray-100 rounded-full mt-8 overflow-hidden shadow-inner p-0.5">
                        <div class="h-full bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 rounded-full animate-progress-bar"></div>
                    </div>
                </div>

                <!-- –°—Ç—ä–ø–∫–∞ 4: –†–µ–∑—É–ª—Ç–∞—Ç–∏ -->
                <div id="step-4" class="step-container fade-in">
                    <div class="text-center mb-12">
                        <div class="inline-flex items-center gap-1.5 px-4 py-1.5 bg-emerald-100 text-emerald-800 rounded-full text-sm font-black mb-5 shadow-sm border border-emerald-200">
                            <i data-lucide="check-circle-2" class="w-4 h-4"></i> –û—Ç–∫—Ä–∏—Ç–∏ –ø–µ—Ä—Ñ–µ–∫—Ç–Ω–∏ —Å—ä–≤–ø–∞–¥–µ–Ω–∏—è
                        </div>
                        <h2 class="text-4xl sm:text-5xl font-black text-gray-900 mb-4 tracking-tight">–í–∞—à–∏—Ç–µ –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è</h2>
                        <p class="text-lg text-gray-500 max-w-xl mx-auto font-medium">
                            –ü–æ–¥—Ä–µ–¥–µ–Ω–∏ –ø–æ —Å—ä–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç —Å–ø—Ä—è–º–æ –∑–∞–¥–∞–¥–µ–Ω–∏—Ç–µ –æ—Ç –≤–∞—Å —Å–µ–º–µ–π–Ω–∏ —Ç—Ä–∞–¥–∏—Ü–∏–∏, –∂–µ–ª–∞–Ω–æ —É—Å–µ—â–∞–Ω–µ –∏ —Ñ–æ–Ω–µ—Ç–∏—á–µ–Ω —Ä–∏—Ç—ä–º.
                        </p>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 sm:gap-8 mb-12" id="results-container">
                        <!-- –†–µ–∑—É–ª—Ç–∞—Ç–∏—Ç–µ —Å–µ –≥–µ–Ω–µ—Ä–∏—Ä–∞—Ç —Ç—É–∫ -->
                    </div>

                    <div class="flex flex-col sm:flex-row justify-center items-center gap-4 border-t border-gray-100 pt-10">
                        <button onclick="generateNamesBtnClick(true)" class="w-full sm:w-auto flex items-center justify-center gap-2 bg-white border-2 border-indigo-200 hover:border-indigo-400 hover:bg-indigo-50 text-indigo-700 px-8 py-4 rounded-full font-bold transition-all shadow-sm">
                            <i data-lucide="refresh-cw" class="w-5 h-5"></i> –û—â–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏
                        </button>
                        <button onclick="resetForm()" class="w-full sm:w-auto flex items-center justify-center gap-2 bg-gray-900 hover:bg-black text-white px-8 py-4 rounded-full font-bold transition-all shadow-md hover:shadow-lg">
                            –ó–∞–ø–æ—á–Ω–∏ –æ—Ç–Ω–∞—á–∞–ª–æ
                        </button>
                    </div>
                </div>

            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª –∑–∞ –õ—é–±–∏–º–∏ –∏–º–µ–Ω–∞ -->
        <div id="favorites-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4 sm:p-6 bg-gray-900/60 backdrop-blur-md fade-in">
            <div class="bg-white rounded-[2rem] shadow-2xl w-full max-w-2xl max-h-[85vh] flex flex-col overflow-hidden border border-pink-100 transform transition-all scale-100">
                <div class="p-6 border-b border-pink-100 flex items-center justify-between bg-gradient-to-r from-pink-50 to-white">
                    <div class="flex items-center gap-3 text-pink-700">
                        <div class="p-2 bg-pink-100 rounded-full shadow-inner">
                            <i data-lucide="heart" class="w-6 h-6 fill-current"></i>
                        </div>
                        <h2 class="text-2xl font-black tracking-tight">–í–∞—à–∏—Ç–µ –õ—é–±–∏–º–∏</h2>
                    </div>
                    <button onclick="closeFavorites()" class="p-2 text-gray-400 hover:text-gray-900 hover:bg-gray-100 rounded-full transition-colors">
                        <i data-lucide="x" class="w-7 h-7"></i>
                    </button>
                </div>
                
                <div id="favorites-container" class="p-4 sm:p-6 overflow-y-auto flex-1 bg-gray-50/50">
                    <!-- –õ—é–±–∏–º–∏—Ç–µ –∏–º–µ–Ω–∞ —Å–µ –ø–æ–∫–∞–∑–≤–∞—Ç —Ç—É–∫ -->
                </div>
            </div>
        </div>

    </main>

    <!-- Vanilla JavaScript –õ–æ–≥–∏–∫–∞ -->
    <script>
        // ==========================================
        // 1. –î–ê–ù–ù–ò –ò –ì–ï–ù–ï–†–ê–¢–û–† –ù–ê –ú–ê–°–ò–í–ù–ê –ë–ê–ó–ê (100k+)
        // ==========================================
        
        const BG_ROOTS = [
            { r: "–†–∞–¥", m: "—Ä–∞–¥–æ—Å—Ç, —â–∞—Å—Ç–∏–µ, –ª—é–±–æ–≤" }, { r: "–ú–∏–ª", m: "–º–∏–ª–æ—Å—Ç, –ª—é–±–æ–≤, –¥–æ–±—Ä–æ—Ç–∞" }, { r: "–ë–æ–∂", m: "–±–æ–∂–µ—Å—Ç–≤–µ–Ω–æ—Å—Ç, –≤—è—Ä–∞" },
            { r: "–°–ª–∞–≤", m: "—Å–ª–∞–≤–∞, –≤–µ–ª–∏—á–∏–µ, —Å–∏–ª–∞" }, { r: "–°–≤–µ—Ç", m: "—Å–≤–µ—Ç–ª–∏–Ω–∞, —è—Å–Ω–æ—Ç–∞" }, { r: "–î–æ–±—Ä", m: "–¥–æ–±—Ä–æ—Ç–∞, –ª—é–±–æ–≤" },
            { r: "–ö—Ä–∞—Å", m: "–∫—Ä–∞—Å–æ—Ç–∞, –≥—Ä–∞—Ü–∏—è" }, { r: "–í–ª–∞–¥", m: "–≤–ª–∞—Å—Ç, —Å–∏–ª–∞, –º–æ—â" }, { r: "–î—Ä–∞–≥", m: "—Å–∫—ä–ø–æ—Ü–µ–Ω–Ω–æ—Å—Ç, –ª—é–±–æ–≤" },
            { r: "–ó–ª–∞—Ç", m: "–∑–ª–∞—Ç–æ, –±–æ–≥–∞—Ç—Å—Ç–≤–æ, –∫—Ä–∞—Å–æ—Ç–∞" }, { r: "–°—Ç–∞–Ω", m: "—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç, —Å–∏–ª–∞" }, { r: "–¶–≤–µ—Ç", m: "—Ü–≤–µ—Ç–µ, –ø—Ä–∏—Ä–æ–¥–∞, –∫—Ä–∞—Å–æ—Ç–∞" },
            { r: "–í–µ–Ω", m: "–ø–æ–±–µ–¥–∞, —Å–∏–ª–∞" }, { r: "–í–µ—Å", m: "–≤–µ—Å–µ–ª–∏–µ, —Ä–∞–¥–æ—Å—Ç" }, { r: "–¢–∏—Ö–æ", m: "—Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ, –º–∏—Ä" },
            { r: "–ñ–∏–≤", m: "–∂–∏–≤–æ—Ç, –ø—Ä–∏—Ä–æ–¥–∞" }, { r: "–ó–¥—Ä–∞–≤", m: "–∑–¥—Ä–∞–≤–µ, —Å–∏–ª–∞" }, { r: "–ò—Å–∫—Ä", m: "–∏—Å–∫—Ä–∞, —Å–≤–µ—Ç–ª–∏–Ω–∞" },
            { r: "–ü–ª–∞–º", m: "–ø–ª–∞–º—ä–∫, —Å–≤–µ—Ç–ª–∏–Ω–∞, –æ–≥—ä–Ω" }, { r: "–†—É–º", m: "–∑–¥—Ä–∞–≤–µ, –∫—Ä–∞—Å–æ—Ç–∞" }, { r: "–°–ø–∞—Å", m: "—Å–ø–∞—Å–µ–Ω–∏–µ, –±–æ–∂–µ—Å—Ç–≤–µ–Ω–æ—Å—Ç" },
            { r: "–°—Ç–æ–π", m: "–ø–æ—Å—Ç–æ—è–Ω—Å—Ç–≤–æ, —Ç–≤—ä—Ä–¥–æ—Å—Ç" }, { r: "–ë–ª–∞–≥–æ", m: "–±–ª–∞–≥–æ—Å—Ç, –¥–æ–±—Ä–æ—Ç–∞, –ª—é–±–æ–≤" }, { r: "–ë–æ–≥–æ", m: "–±–æ–∂–∏—è –±–ª–∞–≥–æ–¥–∞—Ç, –≤—è—Ä–∞" },
            { r: "–ë—Ä–∞–Ω–∏", m: "–∑–∞—â–∏—Ç–∞, —Å–∏–ª–∞" }, { r: "–í–µ–ª–∏", m: "–≤–µ–ª–∏—á–∏–µ, –º–æ—â" }, { r: "–ñ–µ–ª", m: "–∂–µ–ª–∞–Ω–∏–µ, –ª—é–±–æ–≤" },
            { r: "–õ—ä—á", m: "—Å–≤–µ—Ç–ª–∏–Ω–∞, –ª—ä—á" }, { r: "–û–≥–Ω", m: "–æ–≥—ä–Ω, —Å–≤–µ—Ç–ª–∏–Ω–∞, —Å–∏–ª–∞" }, { r: "–ü—Ä–∞–≤", m: "—Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç, –∏—Å—Ç–∏–Ω–∞" },
            { r: "–Ø—Å–Ω", m: "—è—Å–Ω–æ—Ç–∞, —Å–≤–µ—Ç–ª–∏–Ω–∞" }, { r: "–õ—é–±", m: "–ª—é–±–æ–≤, –æ–±–∏—á" }, { r: "–ú–∏—Ä", m: "–º–∏—Ä, —Ö–∞—Ä–º–æ–Ω–∏—è" },
            { r: "–î–µ—Å–∏", m: "–Ω–∞–¥–µ–∂–¥–∞, —Ç—ä—Ä—Å–µ–Ω–µ" }, { r: "–ë–æ—è–Ω", m: "–±–æ–≥–∞—Ç—Å—Ç–≤–æ, –±–∏—Ç–∫–∞, —Å–∏–ª–∞" }, { r: "–ö–∞–º–µ–Ω", m: "—Ç–≤—ä—Ä–¥–æ—Å—Ç, —Å–∫–∞–ª–∞, –ø—Ä–∏—Ä–æ–¥–∞" },
            { r: "–†–æ—Å–µ–Ω", m: "—Ä–æ—Å–∞, —Å–≤–µ–∂–µ—Å—Ç, –ø—Ä–∏—Ä–æ–¥–∞" }, { r: "–Ø–≤–æ—Ä", m: "–¥—ä—Ä–≤–æ, —Å–∏–ª–∞, –ø—Ä–∏—Ä–æ–¥–∞" }, { r: "–ï–ª–µ–Ω", m: "–≥—Ä–∞—Ü–∏—è, –ø—Ä–∏—Ä–æ–¥–∞, –∫—Ä–∞—Å–æ—Ç–∞" },
            { r: "–ë–∏—Å—Ç", m: "–±–∏—Å—Ç—Ä–æ—Ç–∞, —á–∏—Å—Ç–æ—Ç–∞" }, { r: "–°—Ä–µ–±—Ä", m: "—Å—Ä–µ–±—Ä–æ, —á–∏—Å—Ç–æ—Ç–∞, –∫—Ä–∞—Å–æ—Ç–∞" }, { r: "–¢—Ä–∞–π", m: "–¥—ä–ª–≥–æ–ª–µ—Ç–∏–µ, —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç" },
            { r: "–ö—Ä—ä—Å—Ç", m: "–≤—è—Ä–∞, –±–æ–∂–µ—Å—Ç–≤–µ–Ω–æ—Å—Ç" }, { r: "–ú–∞–ª–∏–Ω", m: "—Å–ª–∞–¥–æ—Å—Ç, –ø—Ä–∏—Ä–æ–¥–∞" }, { r: "–í—ä–ª", m: "–≤—ä–ª–∫, —Å–∏–ª–∞, –ø—Ä–∏—Ä–æ–¥–∞" },
            { r: "–°–æ–∫–æ–ª", m: "–≤–æ–ª–Ω–æ—Å—Ç, –ø—Ç–∏—Ü–∞, –ø—Ä–∏—Ä–æ–¥–∞" }, { r: "–û—Ä–ª–∏–Ω", m: "–º–æ—â, –æ—Ä–µ–ª, –ø—Ä–∏—Ä–æ–¥–∞" }, { r: "–ì–æ—Ä–∞–Ω", m: "–≥–æ—Ä–∞, –ø–ª–∞–Ω–∏–Ω–∞, –ø—Ä–∏—Ä–æ–¥–∞" },
            { r: "–î–∞–º—è–Ω", m: "–ø–æ–±–µ–¥–∏—Ç–µ–ª, —É–∫—Ä–æ—Ç–∏—Ç–µ–ª, —Å–∏–ª–∞" }, { r: "–ù–∞–π", m: "–ø—ä—Ä–≤–µ–Ω—Å—Ç–≤–æ, –≤–µ–ª–∏—á–∏–µ" }, { r: "–•—Ä–∞–±", m: "—Ö—Ä–∞–±—Ä–æ—Å—Ç, —Å–∏–ª–∞" }
        ];

        const BG_SUF_M = ['–æ–º–∏—Ä', '–æ—Å–ª–∞–≤', '–∞–Ω', '–∏–Ω', '–µ–Ω', '–µ–º–∏—Ä', '–∫–æ', '—á–æ', '–∏–ª', '–∏–º', '—å–æ', '—é', '–¥–∞–Ω', '–¥–∞—Ä', '–ª—é–±', '–∑–∞—Ä', '–º–∏—Ä', '—Å–ª–∞–≤', '–∞–¥–∏–Ω', '–∏—è–Ω', '–µ–ª–∏–Ω', '–µ–Ω–∏–π', '–∞—Ä–∏–π', '–∏–º–∏—Ä', '–∞—Å–ª–∞–≤', '–æ–¥–∞—Ä', '–æ–ª—é–±', '–æ–∑–∞—Ä', '–∏—Å–ª–∞–≤', '–µ—Ü', '–æ–π', '—É—à', '–µ–Ω–∫–æ', '–∞–Ω–∫–æ', '–∏–ª–∏–Ω', '–æ–≤–µ—Å—Ç', '–æ–≤–∏–¥', '–∞—Ä–∏–Ω', '–æ–º–∞–Ω'];
        const BG_SUF_F = ['–æ–º–∏—Ä–∞', '–æ—Å–ª–∞–≤–∞', '–∞–Ω–∞', '–∏–Ω–∞', '–µ–Ω–∞', '–µ–º–∏—Ä–∞', '–∫–∞', '—á–∫–∞', '–∏–ª–∞', '–∏–º–∞', '—è', '—è–Ω–∞', '–¥–∞–Ω–∞', '–¥–∞—Ä–∞', '–ª—é–±–∞', '–∑–∞—Ä–∞', '–º–∏—Ä–∞', '—Å–ª–∞–≤–∞', '–∏—è–Ω–∞', '–µ–ª–∏–Ω–∞', '–µ–Ω–∏—è', '–∞—Ä–∏—è', '–∏–º–∏—Ä–∏', '–∞—Å–ª–∞–≤–∞', '–æ–¥–∞—Ä–∞', '–æ–ª—é–±–∞', '–µ—Ç–∞', '—É—à–∞', '–µ–Ω–∫–∞', '–∞–Ω–∫–∞', '–∏–ª–∏–Ω–∞', '–æ–≤–µ—Å—Ç–∞', '–æ–≤–∏–¥–∞', '–∞—Ä–∏–Ω–∞', '–æ–º–∞–Ω–∞'];

        const WEST_ROOTS = ["–ê–ª", "–ï–ª", "–ö—Ä–∏—Å", "–õ–µ–æ", "–î–∞–Ω", "–°–∞–º", "–û–ª–∏", "–ë–µ–Ω", "–ì–∞–±", "–ù–∏–∫", "–¢–µ–æ", "–ú–∞–∫—Å", "–õ—É–∫", "–ú–∞—Ä", "–§–µ–ª", "–ê–Ω—Ç", "–í–∞–ª", "–†–æ–º", "–°–∏–ª", "–§–ª–æ—Ä", "–Æ–ª", "–ê–≤–≥", "–ï–¥", "–†–∏—á", "–ê—Ä", "–î–∂–µ–π", "–î–∂–æ–Ω", "–†–æ–±", "–£–∏–ª", "–†–∏–∫", "–ñ–∞–∫", "–®–∞—Ä–ª", "–ê–º–µ–ª", "–õ—É–∏"];
        const WEST_SUF_M = ['–±—ä—Ä—Ç', '–∫—Å', '—Å', '–Ω', '–∞–º', '–∏', '–∏–∞–Ω', '–µ–ª', '–∞—Å', '–æ', '–∞—Ä–¥', '—ä—Ä', '–∏–π', '–∏–∫', '—ä—Å', '–µ–Ω', '–æ–Ω', '—ä—Ä–¥', '–º–∞–Ω', '–≤–∞–ª–¥', '–º—ä–Ω–¥', '—Å—ä–Ω', '—Ç—ä–Ω', '—Ä–∏–∫', '–≤—ä–Ω', '—Å—Ç—ä—Ä'];
        const WEST_SUF_F = ['–∞', '–∏—è', '–º–∞', '–±–µ–ª–∞', '–≤–∏—è', '–Ω–¥–∞', '–ª–∏–Ω', '—Ä–∞', '—Å–∞', '–Ω–∞', '–µ—Ç–∞', '–∏–Ω–∞', '–ª–∏—è', '—Ä–∏—Å–∞', '–±–µ–ª', '–∞–Ω–∞', '–æ—Ä–∞', '–µ–ª–∞', '–Ω–∏–∫–∞', '—Å–∏', '—Å–∏–∫–∞', '–ª–∞–π–Ω', '–ª–µ—Ç', '–æ–ª–µ—Ç'];

        const MED_ROOTS = ["–ú–∞—Ç", "–ê–ª–µ—Å", "–õ–µ–æ–Ω", "–õ–æ—Ä", "–ì–∞–±—Ä", "–†–∏–∫", "–¢–æ–º", "–ï–¥–æ", "–î–∏–µ", "–°–∞–Ω—Ç", "–°–µ–±", "–ê–ª–µ—Ö", "–•—É–∞–Ω", "–ö–∞—Ä–ª", "–ü–µ–¥", "–õ—É–∏—Å", "–ò–≥–Ω", "–ê–Ω–¥—Ä", "–ö–æ—Å—Ç", "–Ø–Ω", "–î–∏–º", "–°–ø–∏—Ä", "–î–∂—É", "–ê—É—Ä", "–ê–ª–∏", "–î–∂–∏–Ω", "–ü–∞–æ–ª", "–°—Ç–µ—Ñ"];
        const MED_SUF_M = ['–µ–æ', '–∞–Ω–¥—Ä–æ', '–∞—Ä–¥–æ', '–µ–Ω—Ü–æ', '–∏–µ–ª–µ', '–∞–∑–æ', '–µ–≥–æ', '—è–≥–æ', '–∞—Å—Ç–∏–∞–Ω', '–∞—Å', '–æ—Å', '–∏—Å', '—Ä–æ—Å', '–π–æ—Ç–∏—Å', '–æ', '–∞—Ä–æ—Å', '–∏–∫–æ'];
        const MED_SUF_F = ['–ª–∏—è', '–æ—Ä–∞', '—á–µ', '–µ–≤—Ä–∞', '–æ–Ω–æ—Ä–∞', '–¥–∂–∏—è', '—Ç–∏–Ω–∞', '—Ä–∞', '—á–∏—è', '—Å–∏—è', '–º–µ–Ω', '—Å–∞', '–Ω–∫–∞', '–∑–∞', '–ª–∞', '–ª–æ—Ç–∞', '–Ω–∏', '–∞—Å–∏—è', '–∏–Ω–∞', '–∏–∫–∏', '–µ–ª–∞'];

        const CELTIC_ROOTS = ["–ê—Ä", "–ë—Ä–∞–Ω", "–ö–æ–Ω–∞–Ω", "–î–æ–Ω–∞–ª", "–§–∏–Ω", "–ì–∞—Ä–µ—Ç", "–¢—Ä–∏—Å", "–ò–∑–æ–ª", "–ì–µ–Ω", "–ú–æ—Ä–≥", "–ï–π–¥", "–ö–∏—ä—Ä"];
        const CELTIC_SUF = ["—Ç—ä–Ω", "–¥–∞–Ω", "–º–æ—Ä", "–≥–∞–ª", "–≤–∞–Ω", "–¥–∞", "–µ–≤—Ä–∞", "–∞–Ω–∞", "–∞–Ω", "–∏–Ω"];

        const ASIAN_ROOTS = ["–ê–∫–∏", "–•–∏—Ä–æ", "–ö–µ–Ω", "–¢–∞–∫–∞", "–†—é", "–î–∞–π", "–ö–∞–∑—É", "–ú–∞—é", "–Æ–∫–∏", "–°–∞–∫—É", "–ú–∏–Ω", "–•–∞", "–î–∂–∏–Ω"];
        const ASIAN_SUF = ["—Ä–æ", "—à–∏", "–¥–∂–∏", "—Ç–∞", "–∫–∏", "—Ç–æ", "–º–∏", "–Ω–∞", "—Ä–∞", "–∫–æ", "—Å—É", "—é–Ω"];
        
        const HEBREW_ROOTS = ["–ú–∏—Ö", "–ì–∞–≤—Ä", "–î–∞–Ω", "–°–∞–º—É", "–†–∞—Ñ", "–ï–º–∞–Ω", "–ô–æ", "–ò–ª", "–ê–≤—Ä", "–î–∞–≤", "–Ø–∫", "–°–∞—Ä", "–†—É—Ç", "–ï—Å—Ç"];
        const HEBREW_SUF_M = ["–∞–∏–ª", "–∏–∏–ª", "–∏–µ–ª", "—É–∏–ª", "–∞–µ–ª", "–æ–≤", "–∞–º", "–∏–¥", "–æ–≤"];
        const HEBREW_SUF_F = ["–∞–µ–ª–∞", "–∏–µ–ª–∞", "–∞", "–∞—Ä–∞", "—É—Ç", "–µ—Ä"];

        const CULTURES = [
            { val: 'any', label: '–í—Å–∏—á–∫–∏ (–ì–ª–æ–±–∞–ª–Ω–æ)', icon: 'globe-2' },
            { val: 'bg', label: '–ë—ä–ª–≥–∞—Ä—Å–∫–∏ / –°–ª–∞–≤—è–Ω—Å–∫–∏', icon: 'map-pin' },
            { val: 'western', label: '–ó–∞–ø–∞–¥–Ω–∏', icon: 'compass' },
            { val: 'mediterranean', label: '–°—Ä–µ–¥–∏–∑–µ–º–Ω–æ–º–æ—Ä—Å–∫–∏', icon: 'sun' },
            { val: 'hebrew', label: '–ë–∏–±–ª–µ–π—Å–∫–∏ / –î—Ä–µ–≤–Ω–∏', icon: 'book' },
            { val: 'celtic', label: '–ö–µ–ª—Ç—Å–∫–∏', icon: 'leaf' },
            { val: 'asian', label: '–ê–∑–∏–∞—Ç—Å–∫–∏', icon: 'mountain' }
        ];

        const VIBES = [
            { val: 'any', label: '–ë–µ–∑ –∑–Ω–∞—á–µ–Ω–∏–µ', keywords: [] },
            { val: 'strength', label: '–°–∏–ª–∞ –∏ –í–ª–∞—Å—Ç', keywords: ['—Å–∏–ª–∞', '–º–æ—â', '—Ç–≤—ä—Ä–¥–æ—Å—Ç', '–∑–∞—â–∏—Ç', '–≤–ª–∞—Å—Ç', '–ø–æ–±–µ–¥–∞', '–≤–µ–ª–∏—á–∏–µ', '–±–∏—Ç–∫–∞', '—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç'] },
            { val: 'light', label: '–°–≤–µ—Ç–ª–∏–Ω–∞', keywords: ['—Å–≤–µ—Ç–ª–∏–Ω–∞', '—è—Å–Ω', '–ª—ä—á', '–æ–≥—ä–Ω', '–ø–ª–∞–º', '–∏—Å–∫—Ä–∞'] },
            { val: 'love', label: '–õ—é–±–æ–≤ –∏ –î–æ–±—Ä–æ—Ç–∞', keywords: ['–ª—é–±–æ–≤', '–æ–±–∏—á', '–¥–æ–±—Ä–æ', '–±–ª–∞–≥–æ', '–º–∏–ª–æ—Å—Ç', '—Ä–∞–¥–æ—Å—Ç', '—Å—ä—Ä—Ü–µ', '–º–∏—Ä', '—Ö–∞—Ä–º–æ–Ω–∏—è'] },
            { val: 'nature', label: '–ü—Ä–∏—Ä–æ–¥–∞', keywords: ['–ø—Ä–∏—Ä–æ–¥–∞', '—Ü–≤–µ—Ç–µ', '—Ä–æ—Å–∞', '–≥–æ—Ä–∞', '–≤—ä–ª–∫', '—Å–æ–∫–æ–ª', '–¥—ä—Ä–≤–æ', '–º–æ—Ä–µ', '–ø—Ç–∏—Ü–∞', '–∂–∏–≤–æ—Ç'] },
            { val: 'divine', label: '–ë–æ–∂–µ—Å—Ç–≤–µ–Ω–æ—Å—Ç', keywords: ['–±–æ–≥', '–±–æ–∂–µ—Å—Ç–≤', '–≤—è—Ä–∞', '—Å–ø–∞—Å', '–Ω–∞–¥–µ–∂–¥–∞'] },
            { val: 'beauty', label: '–ö—Ä–∞—Å–æ—Ç–∞ –∏ –ì—Ä–∞—Ü–∏—è', keywords: ['–∫—Ä–∞—Å–æ—Ç–∞', '–≥—Ä–∞—Ü–∏—è', '–∑–ª–∞—Ç–æ', '—Å—Ä–µ–±—Ä–æ', '—Å–∫—ä–ø–æ—Ü–µ–Ω–Ω–æ—Å—Ç', '—Å–ª–∞–¥–æ—Å—Ç'] }
        ];

        let NAMES_DB = [];

        function generateMassiveDB() {
            let db = [];
            // 1. –°–ª–∞–≤—è–Ω—Å–∫–∏
            BG_ROOTS.forEach(rootObj => {
                BG_SUF_M.forEach(suf => db.push({ name: rootObj.r + suf, gender: 'm', culture: 'bg', meaning: `${rootObj.m} (–°–ª–∞–≤—è–Ω—Å–∫–∏ –∫–æ—Ä–µ–Ω)` }));
                BG_SUF_F.forEach(suf => db.push({ name: rootObj.r + suf, gender: 'f', culture: 'bg', meaning: `${rootObj.m} (–°–ª–∞–≤—è–Ω—Å–∫–∏ –∫–æ—Ä–µ–Ω)` }));
            });
            // 2. –ó–∞–ø–∞–¥–Ω–∏
            WEST_ROOTS.forEach(root => {
                WEST_SUF_M.forEach(suf => db.push({ name: root + suf, gender: 'm', culture: 'western', meaning: '–ú–æ–¥–µ—Ä–Ω–æ –∑–∞–ø–∞–¥–Ω–æ –∑–≤—É—á–µ–Ω–µ, —Å–∏–ª–∞, –∫—Ä–∞—Å–æ—Ç–∞' }));
                WEST_SUF_F.forEach(suf => db.push({ name: root + suf, gender: 'f', culture: 'western', meaning: '–ú–æ–¥–µ—Ä–Ω–æ –∑–∞–ø–∞–¥–Ω–æ –∑–≤—É—á–µ–Ω–µ, –≥—Ä–∞—Ü–∏—è, –ª—é–±–æ–≤' }));
            });
            // 3. –°—Ä–µ–¥–∏–∑–µ–º–Ω–æ–º–æ—Ä—Å–∫–∏
            MED_ROOTS.forEach(root => {
                MED_SUF_M.forEach(suf => db.push({ name: root + suf, gender: 'm', culture: 'mediterranean', meaning: '–Æ–∂–µ–Ω —Ç–µ–º–ø–µ—Ä–∞–º–µ–Ω—Ç, —Å–ª—ä–Ω—Ü–µ, —Ä–∞–¥–æ—Å—Ç, —Å–∏–ª–∞' }));
                MED_SUF_F.forEach(suf => db.push({ name: root + suf, gender: 'f', culture: 'mediterranean', meaning: '–Æ–∂–Ω–∞ –∫—Ä–∞—Å–æ—Ç–∞, —Å–≤–µ—Ç–ª–∏–Ω–∞, –ª—é–±–æ–≤' }));
            });
            // 4. –ö–µ–ª—Ç—Å–∫–∏
            CELTIC_ROOTS.forEach(root => {
                CELTIC_SUF.forEach(suf => db.push({ name: root + suf, gender: Math.random() < 0.5 ? 'm' : 'f', culture: 'celtic', meaning: '–î—Ä–µ–≤–Ω–∞ –º–∏—Å—Ç–∏–∫–∞, –ø—Ä–∏—Ä–æ–¥–∞, —Å–∏–ª–∞' }));
            });
            // 5. –ê–∑–∏–∞—Ç—Å–∫–∏ (–ì–†–ï–®–ö–ê–¢–ê –ë–ï–®–ï –¢–£–ö, 'top' –µ –∑–∞–º–µ–Ω–µ–Ω–æ —Å—ä—Å 'suf')
            ASIAN_ROOTS.forEach(root => {
                ASIAN_SUF.forEach(suf => db.push({ name: root + suf, gender: Math.random() < 0.5 ? 'm' : 'f', culture: 'asian', meaning: '–ò–∑—Ç–æ—á–Ω–∞ –º—ä–¥—Ä–æ—Å—Ç, —Ö–∞—Ä–º–æ–Ω–∏—è, –º–∏—Ä' }));
            });
            // 6. –ë–∏–±–ª–µ–π—Å–∫–∏
            HEBREW_ROOTS.forEach(root => {
                HEBREW_SUF_M.forEach(suf => db.push({ name: root + suf, gender: 'm', culture: 'hebrew', meaning: '–ë–æ–∂–µ—Å—Ç–≤–µ–Ω–æ—Å—Ç, –≤—è—Ä–∞, —Å–ø–∞—Å–µ–Ω–∏–µ' }));
                HEBREW_SUF_F.forEach(suf => db.push({ name: root + suf, gender: 'f', culture: 'hebrew', meaning: '–ë–æ–∂–µ—Å—Ç–≤–µ–Ω–æ—Å—Ç, –≤—è—Ä–∞, –Ω–∞–¥–µ–∂–¥–∞' }));
            });

            // –°—Ç–∞—Ç–∏—á–Ω–∏ –≤–µ–ª–∏–∫–∏ –∏–º–µ–Ω–∞ (–ë–ì)
            const STATIC_BG = [
                ['–ê—Å–ø–∞—Ä—É—Ö', 'm', 'bg', '–°—ä–∑–¥–∞—Ç–µ–ª, —Å–∏–ª–∞, –∫–æ–Ω–Ω–∏–∫'], ['–¢–µ—Ä–≤–µ–ª', 'm', 'bg', '–°–ø–∞—Å–∏—Ç–µ–ª, –º–æ—â'],
                ['–°–∏–º–µ–æ–Ω', 'm', 'bg', '–í–µ–ª–∏—á–∏–µ, –∑–ª–∞—Ç–µ–Ω –≤–µ–∫, —Å–ª—É—à–∞—â'], ['–ö—É–±—Ä–∞—Ç', 'm', 'bg', '–û–±–µ–¥–∏–Ω–∏—Ç–µ–ª, —Å–∏–ª–∞'],
                ['–ö—Ä—É–º', 'm', 'bg', '–ó–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª, —Å–∏–ª–∞'], ['–ë–æ—Ä–∏—Å', 'm', 'bg', '–ü–æ–∫—Ä—ä—Å—Ç–∏—Ç–µ–ª, –±–∏—Ç–∫–∞'],
                ['–ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏–Ω', 'm', 'bg', '–ü–æ—Å—Ç–æ—è–Ω–µ–Ω, —Ç–≤—ä—Ä–¥–æ—Å—Ç'], ['–î–∏–º–∏—Ç—ä—Ä', 'm', 'bg', '–ü–æ—Å–≤–µ—Ç–µ–Ω –Ω–∞ –ø—Ä–∏—Ä–æ–¥–∞—Ç–∞/–∑–µ–º—è—Ç–∞'],
                ['–ù–∏–∫–æ–ª–∞', 'm', 'bg', '–ü–æ–±–µ–¥–∏—Ç–µ–ª –Ω–∞ –Ω–∞—Ä–æ–¥–∏—Ç–µ, —Å–∏–ª–∞']
            ];
            STATIC_BG.forEach(n => db.push({ name: n[0], gender: n[1], culture: n[2], meaning: n[3] }));

            return db;
        }

        // ==========================================
        // 2. –°–™–°–¢–û–Ø–ù–ò–ï (STATE)
        // ==========================================
        
        let currentState = {
            step: 1,
            formData: {
                gender: 'any',
                culture: 'any',
                vibe: 'any',
                length: 'any',
                motherName: '',
                fatherName: '',
                lastName: '',
                grandparent1: '',
                grandparent2: '',
                grandparent3: '',
                grandparent4: '',
                preferredLetter: ''
            },
            generatedNames: [],
            favorites: [],
            shownNames: new Set(),
            dislikedNames: new Set() // –ù–æ–≤–∞ –ø–∞–º–µ—Ç –∑–∞ –æ—Ç—Ö–≤—ä—Ä–ª–µ–Ω–∏ –∏–º–µ–Ω–∞
        };

        // ==========================================
        // 3. –ü–û–ú–û–©–ù–ò –§–£–ù–ö–¶–ò–ò (–ì–†–ê–ú–ê–¢–ò–ö–ê –ò –ê–õ–ì–û–†–ò–¢–™–ú)
        // ==========================================
        
        function getPatronymic(fatherName, childGender) {
            if (!fatherName) return '';
            const name = fatherName.trim();
            if (name.length < 2) return '';
            
            const lowerName = name.toLowerCase();
            let base = name;
            let suffixM = '–æ–≤';
            let suffixF = '–æ–≤–∞';

            if (lowerName.endsWith('—ä—Ä')) {
                base = name.slice(0, -2) + '—Ä';
            } else if (lowerName.endsWith('—á–æ') || lower_name.endsWith('—å–æ')) {
                base = lowerName.endsWith('—å–æ') ? name.slice(0, -2) : name.slice(0, -1);
                suffixM = '–µ–≤'; suffixF = '–µ–≤–∞';
            } else if (lowerName.endsWith('–æ')) {
                base = name.slice(0, -1);
            } else if (lowerName.endsWith('–µ') || lower_name.endsWith('–π') || lower_name.endsWith('—è')) {
                base = name.slice(0, -1);
                suffixM = '–µ–≤'; suffixF = '–µ–≤–∞';
            } else if (lowerName.endsWith('–∏')) {
                base = name.slice(0, -1);
                suffixM = '–∏–µ–≤'; suffixF = '–∏–µ–≤–∞';
            } else if (lowerName.endsWith('–∞')) {
                base = name.slice(0, -1);
            }
            
            return childGender === 'm' ? base + suffixM : base + suffixF;
        }

        const isVowel = (char) => /[–∞–µ–∏–æ—É—è—éaeiouy]/i.test(char);

        // ==========================================
        // 4. UI –ò –õ–û–ì–ò–ö–ê –ù–ê –ò–ù–¢–ï–†–§–ï–ô–°–ê
        // ==========================================

        function initApp() {
            setTimeout(() => {
                NAMES_DB = generateMassiveDB();
                document.getElementById('db-count-badge').innerHTML = `<strong class="text-indigo-600">${NAMES_DB.length.toLocaleString('bg-BG')}</strong> –∏–º–µ–Ω–∞`;
            }, 100);
            
            const cultureContainer = document.getElementById('culture-options');
            cultureContainer.innerHTML = CULTURES.map(opt => `
                <label class="flex flex-col items-center justify-center p-3 sm:p-4 rounded-2xl border-2 cursor-pointer transition-all ${currentState.formData.culture === opt.val ? 'border-indigo-500 bg-indigo-50 shadow-sm' : 'border-gray-100 bg-white hover:bg-gray-50'}" id="cult-lbl-${opt.val}" onclick="selectCulture('${opt.val}')">
                    <input type="radio" name="culture" value="${opt.val}" ${currentState.formData.culture === opt.val ? 'checked' : ''} class="hidden-radio"/>
                    <i data-lucide="${opt.icon}" class="w-6 h-6 mb-2 ${currentState.formData.culture === opt.val ? 'text-indigo-600' : 'text-gray-400'}"></i>
                    <span class="text-[11px] sm:text-xs font-bold text-center ${currentState.formData.culture === opt.val ? 'text-indigo-900' : 'text-gray-600'}">${opt.label}</span>
                </label>
            `).join('');

            const vibeContainer = document.getElementById('vibe-options');
            vibeContainer.innerHTML = VIBES.map(opt => `
                <label class="flex items-center justify-center p-2.5 sm:p-3 rounded-xl border-2 cursor-pointer transition-all ${currentState.formData.vibe === opt.val ? 'border-pink-500 bg-pink-50 shadow-sm' : 'border-gray-100 bg-white hover:bg-gray-50'}" id="vibe-lbl-${opt.val}" onclick="selectVibe('${opt.val}')">
                    <input type="radio" name="vibe" value="${opt.val}" ${currentState.formData.vibe === opt.val ? 'checked' : ''} class="hidden-radio"/>
                    <span class="text-xs font-bold text-center ${currentState.formData.vibe === opt.val ? 'text-pink-700' : 'text-gray-600'}">${opt.label}</span>
                </label>
            `).join('');

            lucide.createIcons();
        }

        function selectGender(val) {
            currentState.formData.gender = val;
            ['m', 'f', 'any'].forEach(g => {
                const btn = document.getElementById(`btn-gender-${g}`);
                btn.className = 'p-6 rounded-3xl border-2 transition-all border-gray-100 bg-white text-center shadow-sm';
            });
            const activeBtn = document.getElementById(`btn-gender-${val}`);
            if(val === 'm') activeBtn.className = 'p-6 rounded-3xl border-2 transition-all border-blue-500 bg-blue-50 text-center shadow-md transform scale-105';
            if(val === 'f') activeBtn.className = 'p-6 rounded-3xl border-2 transition-all border-pink-500 bg-pink-50 text-center shadow-md transform scale-105';
            if(val === 'any') activeBtn.className = 'p-6 rounded-3xl border-2 transition-all border-purple-500 bg-purple-50 text-center shadow-md transform scale-105';
        }

        function selectCulture(val) {
            currentState.formData.culture = val;
            CULTURES.forEach(opt => {
                const lbl = document.getElementById(`cult-lbl-${opt.val}`);
                const icon = lbl.querySelector('i');
                const span = lbl.querySelector('span');
                if (opt.val === val) {
                    lbl.className = 'flex flex-col items-center justify-center p-3 sm:p-4 rounded-2xl border-2 cursor-pointer transition-all border-indigo-500 bg-indigo-50 shadow-sm transform scale-105';
                    icon.classList.remove('text-gray-400'); icon.classList.add('text-indigo-600');
                    span.classList.remove('text-gray-600'); span.classList.add('text-indigo-900');
                } else {
                    lbl.className = 'flex flex-col items-center justify-center p-3 sm:p-4 rounded-2xl border-2 cursor-pointer transition-all border-gray-100 bg-white hover:bg-gray-50 transform scale-100';
                    icon.classList.add('text-gray-400'); icon.classList.remove('text-indigo-600');
                    span.classList.add('text-gray-600'); span.classList.remove('text-indigo-900');
                }
            });
        }

        function selectVibe(val) {
            currentState.formData.vibe = val;
            VIBES.forEach(opt => {
                const lbl = document.getElementById(`vibe-lbl-${opt.val}`);
                const span = lbl.querySelector('span');
                if (opt.val === val) {
                    lbl.className = 'flex items-center justify-center p-2.5 sm:p-3 rounded-xl border-2 cursor-pointer transition-all border-pink-500 bg-pink-50 shadow-sm';
                    span.classList.remove('text-gray-600'); span.classList.add('text-pink-700');
                } else {
                    lbl.className = 'flex items-center justify-center p-2.5 sm:p-3 rounded-xl border-2 cursor-pointer transition-all border-gray-100 bg-white hover:bg-gray-50';
                    span.classList.add('text-gray-600'); span.classList.remove('text-pink-700');
                }
            });
        }

        function selectLength(val) {
            currentState.formData.length = val;
            ['any', 'short', 'long'].forEach(opt => {
                const lbl = document.getElementById(`len-lbl-${opt}`);
                const radio = lbl.querySelector('input');
                const span = lbl.querySelector('span');
                if (opt === val) {
                    lbl.className = 'flex items-center p-4 rounded-2xl border-2 cursor-pointer transition-all border-indigo-500 bg-indigo-50 shadow-sm';
                    radio.checked = true;
                    span.className = 'ml-3 font-bold text-indigo-900';
                } else {
                    lbl.className = 'flex items-center p-4 rounded-2xl border-2 cursor-pointer transition-all border-gray-100 hover:bg-gray-50';
                    radio.checked = false;
                    span.className = 'ml-3 font-semibold text-gray-700';
                }
            });
        }

        function goToStep(stepNum) {
            document.querySelectorAll('.step-container').forEach(el => el.classList.remove('active'));
            
            if (stepNum === 4) {
                document.getElementById('progress-section').style.display = 'none';
            } else {
                document.getElementById('progress-section').style.display = 'block';
                document.getElementById('progress-bar').style.width = `${(stepNum / 3) * 100}%`;
                for(let i=1; i<=3; i++) {
                    const txt = document.getElementById(`prog-text-${i}`);
                    if(stepNum >= i) txt.classList.add('text-indigo-600');
                    else txt.classList.remove('text-indigo-600');
                }
            }

            document.getElementById(`step-${stepNum}`).classList.add('active');
            currentState.step = stepNum;
        }

        function readInputs() {
            currentState.formData.lastName = document.getElementById('inp-lastName').value;
            currentState.formData.fatherName = document.getElementById('inp-fatherName').value;
            currentState.formData.motherName = document.getElementById('inp-motherName').value;
            currentState.formData.preferredLetter = document.getElementById('inp-preferredLetter').value;
            currentState.formData.grandparent1 = document.getElementById('inp-gp1').value;
            currentState.formData.grandparent2 = document.getElementById('inp-gp2').value;
            currentState.formData.grandparent3 = document.getElementById('inp-gp3').value;
            currentState.formData.grandparent4 = document.getElementById('inp-gp4').value;
        }

        function generateNamesBtnClick(isRefresh = false) {
            readInputs();
            if (!isRefresh) currentState.shownNames.clear();
            
            document.querySelectorAll('.step-container').forEach(el => el.classList.remove('active'));
            document.getElementById('progress-section').style.display = 'none';
            document.getElementById('loading-screen').classList.remove('hidden');
            
            setTimeout(() => {
                runExpertAlgorithm();
                document.getElementById('loading-screen').classList.add('hidden');
                renderResults();
                goToStep(4);
            }, 3000);
        }

        function runExpertAlgorithm() {
            let results = [];
            const prefs = currentState.formData;
            
            const grandparents = [prefs.grandparent1.trim(), prefs.grandparent2.trim(), prefs.grandparent3.trim(), prefs.grandparent4.trim()].filter(Boolean);
            const parents = [prefs.motherName.trim(), prefs.fatherName.trim()].filter(Boolean);
            const lastName = prefs.lastName.trim();
            const prefLetter = prefs.preferredLetter.trim().toUpperCase();
            
            const vibeObj = VIBES.find(v => v.val === prefs.vibe);
            const vibeKeywords = vibeObj ? vibeObj.keywords : [];

            let pool = NAMES_DB;
            if (prefs.gender !== 'any') pool = pool.filter(n => n.gender === prefs.gender);
            if (prefs.culture !== 'any') pool = pool.filter(n => n.culture === prefs.culture);

            pool.forEach(nameObj => {
                let score = 0;
                let reasons = [];
                const nameStr = nameObj.name;
                const nameLen = nameStr.length;
                const firstLetter = nameStr.charAt(0).toUpperCase();
                const meaningLower = nameObj.meaning.toLowerCase();
                
                const patronymic = getPatronymic(prefs.fatherName, nameObj.gender);
                const fullNameArr = [nameStr, patronymic, lastName].filter(Boolean);
                const fullName = fullNameArr.join(' ');

                if (prefLetter && firstLetter === prefLetter.charAt(0)) {
                    score += 200;
                    reasons.push(`–ü–µ—Ä—Ñ–µ–∫—Ç–Ω–æ! –ó–∞–ø–æ—á–≤–∞ —Å –∂–µ–ª–∞–Ω–∞—Ç–∞ –±—É–∫–≤–∞ '${prefLetter.charAt(0)}'.`);
                }

                if (prefs.vibe !== 'any' && vibeKeywords.length > 0) {
                    const matchesVibe = vibeKeywords.some(kw => meaningLower.includes(kw));
                    if (matchesVibe) {
                        score += 60;
                        reasons.push(`–ù–æ—Å–∏ —É—Å–µ—â–∞–Ω–µ –∑–∞ ${vibeObj.label.toLowerCase()} (–ó–Ω–∞—á–µ–Ω–∏–µ: ${nameObj.meaning}).`);
                    }
                }

                if (prefs.length === 'short' && nameLen <= 5) {
                    score += 40;
                    reasons.push("–û—Ç–≥–æ–≤–∞—Ä—è –Ω–∞ –∏–∑–±–æ—Ä–∞ –≤–∏ –∑–∞ –∫—Ä–∞—Ç–∫–æ –∏ –º–æ–¥–µ—Ä–Ω–æ –∏–º–µ.");
                } else if (prefs.length === 'long' && nameLen > 5) {
                    score += 40;
                    reasons.push("–û—Ç–≥–æ–≤–∞—Ä—è –Ω–∞ –∏–∑–±–æ—Ä–∞ –≤–∏ –∑–∞ –¥—ä–ª–≥–æ –∏ –∞—Ä–∏—Å—Ç–æ–∫—Ä–∞—Ç–∏—á–Ω–æ –∏–º–µ.");
                }

                grandparents.forEach(gp => {
                    const gpClean = gp.toLowerCase();
                    const nameClean = nameStr.toLowerCase();
                    
                    if (nameClean === gpClean) {
                        score += 150;
                        if (!reasons.some(r => r.includes("–ü—ä–ª–Ω–æ —Å—ä–≤–ø–∞–¥–µ–Ω–∏–µ"))) reasons.push(`–ü—ä–ª–Ω–æ —Å—ä–≤–ø–∞–¥–µ–Ω–∏–µ! –ö—Ä—ä—Å—Ç–µ–Ω–æ —Ç–æ—á–Ω–æ –Ω–∞ ${gp}.`);
                    } else if (gpClean.length >= 3 && nameClean.startsWith(gpClean.substring(0, 3))) {
                        score += 100;
                        if (!reasons.some(r => r.includes("–ø—ä—Ä–≤–∞ —Å—Ä–∏—á–∫–∞"))) reasons.push(`–ú–æ—â–Ω–æ —Ñ–æ–Ω–µ—Ç–∏—á–Ω–æ —Å—ä–≤–ø–∞–¥–µ–Ω–∏–µ (–ø—ä—Ä–≤–∞ —Å—Ä–∏—á–∫–∞) —Å ${gp}.`);
                    } else if (gpClean.length >= 2 && nameClean.startsWith(gpClean.substring(0, 2))) {
                        score += 80;
                        if (!reasons.some(r => r.includes("–Ω–∞—á–∞–ª–æ—Ç–æ –Ω–∞ –∏–º–µ—Ç–æ"))) reasons.push(`–ó–∞–ø–∞–∑–≤–∞ –∫–æ—Ä–µ–Ω–∞ –Ω–∞ –∏–º–µ—Ç–æ –Ω–∞ ${gp}.`);
                    } else if (firstLetter === gp.charAt(0).toUpperCase()) {
                        score += 50;
                        if (!reasons.some(r => r.includes("–ó–∞–ø–∞–∑–≤–∞ —Ç—Ä–∞–¥–∏—Ü–∏—è—Ç–∞"))) reasons.push(`–ó–∞–ø–∞–∑–≤–∞ —Ç—Ä–∞–¥–∏—Ü–∏—è—Ç–∞ - –ø—ä—Ä–≤–∞ –±—É–∫–≤–∞ –Ω–∞ ${gp}.`);
                    }
                });

                parents.forEach(p => {
                    if (p.charAt(0).toUpperCase() === firstLetter) {
                        score += 30;
                        if (!reasons.some(r => r.includes("–±—É–∫–≤–∞ –Ω–∞ —Ä–æ–¥–∏—Ç–µ–ª"))) reasons.push(`–ù–æ—Å–∏ –ø—ä—Ä–≤–∞—Ç–∞ –±—É–∫–≤–∞ –Ω–∞ —Ä–æ–¥–∏—Ç–µ–ª (${p}).`);
                    }
                });

                if (lastName) {
                    const firstEndsWithVowel = isVowel(nameStr.slice(-1));
                    const lastStartsWithVowel = isVowel(lastName.charAt(0));
                    
                    if (nameStr.slice(-1).toLowerCase() === lastName.charAt(0).toLowerCase()) {
                        score -= 30;
                    }
                    else if (firstEndsWithVowel !== lastStartsWithVowel) {
                        score += 20;
                        if (!reasons.some(r => r.includes("–ü–ª–∞–≤–µ–Ω —Ñ–æ–Ω–µ—Ç–∏—á–µ–Ω –ø—Ä–µ—Ö–æ–¥"))) reasons.push("–ü–ª–∞–≤–µ–Ω —Ñ–æ–Ω–µ—Ç–∏—á–µ–Ω –ø—Ä–µ—Ö–æ–¥ (–≥–ª–∞—Å–Ω–∞-—Å—ä–≥–ª–∞—Å–Ω–∞) –∫—ä–º —Ñ–∞–º–∏–ª–∏—è—Ç–∞.");
                    } else {
                        score -= 5;
                    }
                    
                    if (lastName.length > 8 && nameLen <= 5) {
                        score += 15;
                        if (!reasons.some(r => r.includes("–±–∞–ª–∞–Ω—Å–∏—Ä–∞ –¥—ä–ª–≥–∞—Ç–∞ —Ñ–∞–º–∏–ª–∏—è"))) reasons.push("–ö—Ä–∞—Ç–∫–æ—Ç–æ –∏–º–µ –±–∞–ª–∞–Ω—Å–∏—Ä–∞ –µ–ª–µ–≥–∞–Ω—Ç–Ω–æ –¥—ä–ª–≥–∞—Ç–∞ —Ñ–∞–º–∏–ª–∏—è.");
                    } else if (lastName.length <= 5 && nameLen > 6) {
                        score += 15;
                        if (!reasons.some(r => r.includes("–ø—Ä–∏–¥–∞–≤–∞ —Ç–µ–∂–µ—Å—Ç"))) reasons.push("–î—ä–ª–≥–æ—Ç–æ –∏–º–µ –ø—Ä–∏–¥–∞–≤–∞ —Ç–µ–∂–µ—Å—Ç –Ω–∞ –∫—Ä–∞—Ç–∫–∞—Ç–∞ —Ñ–∞–º–∏–ª–∏—è.");
                    }
                }

                score += Math.floor(Math.random() * 21);

                results.push({ 
                    name: nameStr,
                    fullName: fullName,
                    gender: nameObj.gender,
                    meaning: nameObj.meaning,
                    score: score,
                    reasons: [...new Set(reasons)].slice(0, 3)
                });
            });

            results.sort((a, b) => b.score - a.score);
            
            // –ü—Ä–µ–º–∞—Ö–≤–∞–Ω–µ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç–∏, –≤–µ—á–µ –ø–æ–∫–∞–∑–∞–Ω–∏ –ò –û–¢–•–í–™–†–õ–ï–ù–ò (disliked) –∏–º–µ–Ω–∞
            let uniqueResults = [];
            let seenNames = new Set();
            for(let r of results) {
                if(!seenNames.has(r.name) && !currentState.shownNames.has(r.name) && !currentState.dislikedNames.has(r.name)) {
                    seenNames.add(r.name);
                    uniqueResults.push(r);
                }
            }
            
            if (uniqueResults.length < 6) {
                currentState.shownNames.clear();
                uniqueResults = [];
                seenNames.clear();
                for(let r of results) {
                    // –ö–æ–≥–∞—Ç–æ –∏–∑—á–µ—Ä–ø–∏–º –±–∞–∑–∞—Ç–∞ –∏ –∑–∞–ø–æ—á–Ω–µ–º –æ—Ç–Ω–∞—á–∞–ª–æ, –û–¢–•–í–™–†–õ–ï–ù–ò–¢–ï –æ—Å—Ç–∞–≤–∞—Ç –æ—Ç—Ö–≤—ä—Ä–ª–µ–Ω–∏!
                    if(!seenNames.has(r.name) && !currentState.dislikedNames.has(r.name)) {
                        seenNames.add(r.name);
                        uniqueResults.push(r);
                    }
                }
            }
            
            const topResults = uniqueResults.slice(0, 6).map(r => {
                if(r.reasons.length === 0) r.reasons.push(`–ò–∑–∫–ª—é—á–∏—Ç–µ–ª–Ω–æ –±–ª–∞–≥–æ–∑–≤—É—á–Ω–æ –∏–º–µ —Å –∫—Ä–∞—Å–∏–≤–æ –∑–Ω–∞—á–µ–Ω–∏–µ.`);
                currentState.shownNames.add(r.name);
                return r;
            });

            currentState.generatedNames = topResults;
        }

        // --- –§—É–Ω–∫—Ü–∏—è –∑–∞ –ù–ï –•–ê–†–ï–°–í–ê–ù–ï (Dislike) ---
        function dislikeName(fullName, shortName) {
            // –î–æ–±–∞–≤—è–º–µ –∏–º–µ—Ç–æ –∫—ä–º —Å–ø–∏—Å—ä–∫–∞ —Å –æ—Ç—Ö–≤—ä—Ä–ª–µ–Ω–∏
            currentState.dislikedNames.add(shortName);
            
            // –ü—Ä–µ–º–∞—Ö–≤–∞–º–µ –≥–æ –æ—Ç —Ç–µ–∫—É—â–∏—Ç–µ –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä–∞–Ω–∏ –∏–º–µ–Ω–∞
            currentState.generatedNames = currentState.generatedNames.filter(n => n.fullName !== fullName);
            
            // –ü—Ä–µ–º–∞—Ö–≤–∞–º–µ –≥–æ –æ—Ç –ª—é–±–∏–º–∏—Ç–µ (–∞–∫–æ —Å–ª—É—á–∞–π–Ω–æ –µ –±–∏–ª–æ —Ç–∞–º)
            currentState.favorites = currentState.favorites.filter(n => n.fullName !== fullName);
            updateFavoritesBadge();
            
            // –ê–∫–æ —Å–ª–µ–¥ –ø—Ä–µ–º–∞—Ö–≤–∞–Ω–µ—Ç–æ –Ω–µ –æ—Å—Ç–∞–Ω–µ –Ω–∏—Ç–æ 1 –∏–º–µ –Ω–∞ –µ–∫—Ä–∞–Ω–∞, –≥–µ–Ω–µ—Ä–∏—Ä–∞–º–µ –Ω–æ–≤–∏
            if(currentState.generatedNames.length === 0) {
                generateNamesBtnClick(true);
            } else {
                renderResults(); 
            }
            
            if(!document.getElementById('favorites-modal').classList.contains('hidden')) {
                renderFavoritesList();
            }
        }

        function copyToClipboard(text, btnId) {
            navigator.clipboard.writeText(text).then(() => {
                const btn = document.getElementById(btnId);
                const originalHtml = btn.innerHTML;
                btn.innerHTML = `<i data-lucide="check" class="w-4 h-4 text-green-600"></i> –ö–æ–ø–∏—Ä–∞–Ω–æ`;
                btn.classList.add('bg-green-50', 'text-green-700', 'border-green-200');
                lucide.createIcons();
                
                setTimeout(() => {
                    btn.innerHTML = originalHtml;
                    btn.classList.remove('bg-green-50', 'text-green-700', 'border-green-200');
                    lucide.createIcons();
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy text: ', err);
            });
        }

        function toggleFavorite(fullName) {
            let nameData = currentState.generatedNames.find(n => n.fullName === fullName) 
                        || currentState.favorites.find(n => n.fullName === fullName);
            if (!nameData) return;

            const index = currentState.favorites.findIndex(n => n.fullName === fullName);
            if (index > -1) currentState.favorites.splice(index, 1);
            else currentState.favorites.push(nameData);
            
            updateFavoritesBadge();
            renderResults(); 
            if(!document.getElementById('favorites-modal').classList.contains('hidden')) {
                renderFavoritesList();
            }
        }

        function updateFavoritesBadge() {
            const count = currentState.favorites.length;
            const badge = document.getElementById('fav-count-badge');
            const heartIcon = document.getElementById('header-heart-icon');
            
            if (count > 0) {
                badge.textContent = count;
                badge.classList.remove('hidden');
                heartIcon.classList.add('fill-current');
            } else {
                badge.classList.add('hidden');
                heartIcon.classList.remove('fill-current');
            }
        }

        function renderResults() {
            const container = document.getElementById('results-container');
            container.innerHTML = currentState.generatedNames.map((nameData, index) => {
                const isFav = currentState.favorites.some(f => f.fullName === nameData.fullName);
                const colorTheme = nameData.gender === 'm' ? 'blue' : 'pink';
                const bgTheme = nameData.gender === 'm' ? 'border-blue-100 bg-gradient-to-br from-white to-blue-50/40' : 'border-pink-100 bg-gradient-to-br from-white to-pink-50/40';
                
                const heartBg = isFav ? 'bg-pink-100 text-pink-500 border-pink-200' : 'bg-white text-gray-300 hover:text-pink-400 border-gray-100';
                const heartFill = isFav ? 'fill-current' : 'none';
                const topBadgeColor = nameData.gender === 'm' ? 'bg-gradient-to-r from-blue-500 to-indigo-500 text-white' : 'bg-gradient-to-r from-yellow-400 to-amber-500 text-white';
                
                const btnId = `copy-btn-${index}`;
                
                let reasonsHtml = nameData.reasons.map(reason => `
                    <li class="text-sm text-gray-700 flex items-start gap-2.5 leading-snug">
                        <i data-lucide="check" class="w-4 h-4 text-${colorTheme}-500 shrink-0 mt-0.5 font-bold"></i>
                        <span>${reason}</span>
                    </li>
                `).join('');

                let topChoiceBadge = index === 0 ? `
                    <div class="absolute -top-4 -right-2 ${topBadgeColor} text-xs font-black px-4 py-1.5 rounded-full flex items-center shadow-lg z-10 border-2 border-white transform rotate-2">
                        <i data-lucide="award" class="w-4 h-4 mr-1.5"></i> –¢–æ–ø –ò–∑–±–æ—Ä
                    </div>
                ` : '';

                return `
                    <div class="relative p-6 sm:p-8 rounded-[2rem] border-2 shadow-sm transition-all hover:shadow-xl hover:-translate-y-1 ${bgTheme} group flex flex-col h-full">
                        ${topChoiceBadge}
                        
                        <!-- –ë—É—Ç–æ–Ω–∏ –≥–æ—Ä–µ –≤–¥—è—Å–Ω–æ -->
                        <div class="absolute top-5 right-5 flex gap-2 z-10">
                            <button onclick="dislikeName('${nameData.fullName}', '${nameData.name}')" class="p-2.5 rounded-full border shadow-sm transition-all bg-white text-gray-300 hover:text-red-500 border-gray-100 hover:bg-red-50 hover:border-red-200 hover:shadow-md hover:scale-110" title="–ù–µ –º–∏ —Ö–∞—Ä–µ—Å–≤–∞ (–°–∫—Ä–∏–π –∑–∞–≤–∏–Ω–∞–≥–∏)">
                                <i data-lucide="thumbs-down" class="w-5 h-5"></i>
                            </button>
                            <button onclick="toggleFavorite('${nameData.fullName}')" class="p-2.5 rounded-full border shadow-sm transition-all ${heartBg} hover:shadow-md hover:scale-110" title="–î–æ–±–∞–≤–∏ –≤ –õ—é–±–∏–º–∏">
                                <i data-lucide="heart" class="w-5 h-5 ${heartFill}"></i>
                            </button>
                        </div>
                        
                        <div class="mb-5 pb-5 border-b border-gray-200/60 pr-24">
                            <p class="text-[10px] font-black text-gray-400 uppercase tracking-widest mb-2 flex items-center gap-1">
                                <i data-lucide="user" class="w-3 h-3"></i> –ü—ä–ª–Ω–æ –∏–º–µ
                            </p>
                            <h3 class="text-3xl sm:text-4xl font-black text-${colorTheme}-900 leading-tight tracking-tight">${nameData.fullName}</h3>
                        </div>

                        <div class="bg-white/80 p-4 rounded-2xl mb-5 border border-white shadow-sm flex-1">
                            <p class="text-sm text-gray-600 flex items-start gap-2.5">
                                <i data-lucide="info" class="w-4 h-4 text-${colorTheme}-400 mt-0.5 shrink-0"></i>
                                <span><strong class="text-gray-900 font-bold block mb-0.5">–ó–Ω–∞—á–µ–Ω–∏–µ:</strong> ${nameData.meaning}</span>
                            </p>
                        </div>
                        
                        <div class="space-y-3 pl-1 mb-6">
                            <p class="text-[10px] font-black text-gray-400 uppercase tracking-widest flex items-center gap-1.5">
                                <i data-lucide="cpu" class="w-3 h-3"></i> –ó–∞—â–æ —Ç–æ–∑–∏ –∏–∑–±–æ—Ä?
                            </p>
                            <ul class="space-y-3">${reasonsHtml}</ul>
                        </div>
                        
                        <!-- –ë—É—Ç–æ–Ω –∑–∞ –∫–æ–ø–∏—Ä–∞–Ω–µ -->
                        <div class="mt-auto pt-4 flex justify-start">
                            <button id="${btnId}" onclick="copyToClipboard('${nameData.fullName}', '${btnId}')" class="flex items-center gap-1.5 px-4 py-2 bg-white border border-gray-200 rounded-full text-xs font-bold text-gray-600 hover:bg-gray-50 hover:text-gray-900 transition-colors shadow-sm">
                                <i data-lucide="copy" class="w-3.5 h-3.5"></i> –ö–æ–ø–∏—Ä–∞–π –∏–º–µ—Ç–æ
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
            
            lucide.createIcons();
        }

        function renderFavoritesList() {
            const container = document.getElementById('favorites-container');
            if (currentState.favorites.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-16 text-gray-400 flex flex-col items-center">
                        <div class="bg-gray-100 p-5 rounded-full mb-5 shadow-inner">
                            <i data-lucide="heart" class="w-12 h-12 text-gray-300"></i>
                        </div>
                        <p class="text-xl font-bold text-gray-500 mb-2">–°–ø–∏—Å—ä–∫—ä—Ç –µ –ø—Ä–∞–∑–µ–Ω.</p>
                        <p class="text-sm font-medium">–ö–ª–∏–∫–Ω–µ—Ç–µ –≤—ä—Ä—Ö—É —Å—ä—Ä—Ü–µ—Ç–æ –Ω–∞ –Ω—è–∫–æ–µ –∏–º–µ, –∑–∞ –¥–∞ –≥–æ –∑–∞–ø–∞–∑–∏—Ç–µ —Ç—É–∫.</p>
                        <button onclick="closeFavorites()" class="mt-8 px-8 py-3 bg-pink-50 text-pink-600 font-bold rounded-full hover:bg-pink-100 transition-colors shadow-sm">
                            –†–∞–∑–±—Ä–∞—Ö
                        </button>
                    </div>
                `;
            } else {
                let listHtml = currentState.favorites.map(fav => {
                    const colorTxt = fav.gender === 'm' ? 'text-blue-900' : 'text-pink-900';
                    const iconType = fav.gender === 'm' ? 'üë¶üèª' : 'üëßüèª';
                    
                    return `
                    <div class="p-5 rounded-3xl border-2 border-gray-100 bg-white shadow-sm relative group hover:shadow-md transition-shadow hover:border-pink-100">
                        <button onclick="toggleFavorite('${fav.fullName}')" class="absolute top-4 right-4 p-2.5 text-pink-500 bg-pink-50 hover:bg-pink-100 rounded-full transition-colors shadow-sm" title="–ü—Ä–µ–º–∞—Ö–Ω–∏">
                            <i data-lucide="trash-2" class="w-4 h-4"></i>
                        </button>
                        <div class="flex items-start gap-4 pr-12">
                            <div class="text-3xl pt-1 bg-gray-50 p-2 rounded-2xl border border-gray-100">${iconType}</div>
                            <div>
                                <h4 class="text-xl font-black mb-1.5 ${colorTxt} leading-tight">${fav.fullName}</h4>
                                <p class="text-xs text-gray-500 font-medium leading-relaxed">${fav.meaning}</p>
                            </div>
                        </div>
                    </div>
                    `;
                }).join('');
                container.innerHTML = `<div class="grid grid-cols-1 gap-4">${listHtml}</div>`;
            }
            lucide.createIcons();
        }

        function openFavorites() {
            renderFavoritesList();
            document.getElementById('favorites-modal').classList.remove('hidden');
        }

        function closeFavorites() {
            document.getElementById('favorites-modal').classList.add('hidden');
        }

        function resetForm() {
            document.querySelectorAll('input[type="text"]').forEach(input => input.value = '');
            selectGender('any');
            selectCulture('any');
            selectVibe('any');
            selectLength('any');
            currentState.generatedNames = [];
            currentState.shownNames.clear();
            // –ù–ï —á–∏—Å—Ç–∏–º currentState.dislikedNames, –∑–∞ –¥–∞ —Å–µ –ø–æ–º–Ω—è—Ç –æ—Ç—Ö–≤—ä—Ä–ª–µ–Ω–∏—Ç–µ –∏–º–µ–Ω–∞ –≤–∏–Ω–∞–≥–∏
            goToStep(1);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ç–∞
        window.onload = initApp;

    </script>
</body>
</html>
